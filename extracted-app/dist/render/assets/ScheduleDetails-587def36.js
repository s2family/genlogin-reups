import{a7 as q,a2 as V,bu as se,G as ue,ah as w,a0 as de,a1 as re,x as ce,am as ie,a8 as pe,aY as me}from"./main-8b08e1d6.js";import{c as J,d as C,b as Q,m as M,S,X as $,Y as n,D as t,u as e,E as f,P as _e,ag as Z,V as m,M as z,$ as c,af as fe,U as T,a2 as E,F as W,f as ve,q as I,ad as ge,a1 as be}from"./_plugin-vue_export-helper-b059e461.js";import{a as ye}from"./useSavedTasks-dbe97dc3.js";import{_ as he}from"./Pagination-ce77c3f3.js";import{_ as G}from"./Select-f7c79767.js";import{N as xe}from"./NoData-e8438a79.js";import{M as Se}from"./Modal-0f4a5102.js";import{D as ke}from"./vuedraggable.umd-e6c5d70a.js";import{a as O,r as Pe,d as Te}from"./useSchedules-84816470.js";import{_ as F}from"./InputNumber-c85d5887.js";import{_ as D}from"./FormItem-52ed65a1.js";import{_ as A}from"./Form-e484375f.js";import{_ as we}from"./Radio-c980589e.js";import{_ as ee}from"./Input-96fa4693.js";import{_ as $e}from"./a-72358bba.js";import{_ as Ce}from"./DatePicker-91499e1f.js";import{_ as Ue}from"./Checkbox-ce86da58.js";import"./lodash-6114c6d4.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";import"./useScriptEditor-4173e447.js";import"./Suffix-fc59bb7a.js";import"./Divider-65f3d898.js";import"./toInteger-0dcb6e10.js";import"./Remove-be3cc84a.js";const De=()=>{const{savedTasks:o,cachedSavedTasks:s,loading:d,defaultParams:p,pagination:_,getAppSavedTasks:v,debounceGetSavedTasks:i,onPageUpdate:r,onPageSizeUpdate:a}=ye(),g=J(()=>o.value.map(x=>{const{id:k,name:y}=x;return{label:y,value:k,id:k,name:y}}));return{savedTasks:o,cachedSavedTasks:s,defaultParams:p,pagination:_,taskOptions:g,loading:d,getAppSavedTasks:v,debounceGetSavedTasks:i,onPageUpdate:r,onPageSizeUpdate:a,handleScroll:async x=>{const{next_offset:k}=_.value,y=x.currentTarget;y.scrollTop+y.offsetHeight>=y.scrollHeight-20&&k!==null&&await v()}}},Le=m("strong",null,"Enter",-1),Ve=C({__name:"SelectTasks",props:{modelValue:{},task:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(o,{emit:s}){const d=Q(!1),{cachedSavedTasks:p,defaultParams:_,taskOptions:v,loading:i,pagination:r,handleScroll:a,getAppSavedTasks:g,onPageUpdate:h}=De(),x=b=>{const P=p.value.filter(R=>b.includes(R.id));s("update:modelValue",b),s("select",P)},k=b=>{_.value.name=b,d.value=!0},y=async()=>{_.value.name="",d.value=!0,await g()},B=async()=>{s("update:modelValue",""),await g()};return M(async()=>{await g()}),(b,P)=>{const R=he,j=q,l=G;return S(),$(l,_e(b.$attrs,{clearable:"",filterable:"",multiple:"",loading:e(i),options:e(v),"on-scroll":e(a),value:o.modelValue,"on-search":k,"on-clear":y,size:"large",placeholder:"Task",onUpdateValue:x,onKeyup:Z(B,["enter"]),onFocus:P[1]||(P[1]=N=>d.value=!0),onBlur:P[2]||(P[2]=N=>d.value=!1)}),{action:n(()=>[t(R,{"page-size":e(r).limit,"onUpdate:pageSize":P[0]||(P[0]=N=>e(r).limit=N),"item-count":e(r).total_items,"on-update:page":e(h),"page-slot":5},null,8,["page-size","item-count","on-update:page"])]),empty:n(()=>[t(j,null,{default:n(()=>[f(" Press "),Le,f(" to search ")]),_:1})]),_:1},16,["loading","options","on-scroll","value","onKeyup"])}}}),Me={class:"flex gap-2"},Oe=C({__name:"TabMinute",props:{cron:{type:String,default:""},data:{type:Object,default:()=>({})}},emits:["update:cron"],setup(o,{emit:s}){const{t:d}=V(),{validator:p}=O(),_=()=>{s("update:cron","* * * * * *")};return z(()=>{_()}),M(()=>{_()}),(v,i)=>{const r=F,a=D,g=A;return S(),$(g,{class:"mt-16px"},{default:n(()=>[t(a,{label:e(d)("Page.Schedules.Label.RepeatEvery")},{default:n(()=>[m("div",Me,[t(r,{value:o.data.repeat,"onUpdate:value":i[0]||(i[0]=h=>o.data.repeat=h),class:"w-300px",min:1,validator:e(p)},null,8,["value","validator"]),f(" "+c(e(d)("Page.Schedules.Label.Minute")),1)])]),_:1},8,["label"])]),_:1})}}}),Ae={class:"flex gap-2"},Be=C({__name:"TabHourly",props:{cron:{type:String,default:""},data:{type:Object,default:()=>({})}},emits:["update:cron"],setup(o,{emit:s}){const{t:d}=V(),{validator:p}=O(),_=()=>{s("update:cron","* * * * * *")};return z(()=>{_()}),M(()=>{_()}),(v,i)=>{const r=F,a=D,g=A;return S(),$(g,{class:"mt-16px"},{default:n(()=>[t(a,{label:e(d)("Page.Schedules.Label.RepeatEvery")},{default:n(()=>[m("div",Ae,[t(r,{value:o.data.repeat,"onUpdate:value":i[0]||(i[0]=h=>o.data.repeat=h),class:"w-300px",min:1,validator:e(p),onKeydown:i[1]||(i[1]=Z(fe(()=>{},["prevent"]),["enter"]))},null,8,["value","validator"]),f(" "+c(e(d)("Page.Schedules.Label.Hour")),1)])]),_:1},8,["label"])]),_:1})}}}),Re=C({__name:"TabDaily",props:{cron:{type:String,default:""},data:{type:Object,default:()=>({})}},emits:["update:cron"],setup(o,{emit:s}){const d=o,{t:p}=V(),{validator:_}=O(),v=()=>{s("update:cron",`${d.data.minute||0} ${d.data.hour||0} * * *`)};return z(()=>{v()}),M(()=>{v()}),(i,r)=>{const a=F,g=D,h=A;return S(),$(h,{class:"mt-16px"},{default:n(()=>[t(g,{label:e(p)("Page.Schedules.Label.RepeatEveryDayAt")},{default:n(()=>[t(a,{value:o.data.hour,"onUpdate:value":r[0]||(r[0]=x=>o.data.hour=x),max:23,min:0,class:"mr-16px",clearable:"","show-button":!1,validator:e(_)},null,8,["value","validator"]),f(" "+c(e(p)("Page.Schedules.Label.Hour"))+" ",1),t(a,{value:o.data.minute,"onUpdate:value":r[1]||(r[1]=x=>o.data.minute=x),class:"mx-16px",max:59,min:0,clearable:"","show-button":!1,validator:e(_)},{default:n(()=>[f(c(e(p)("Page.Schedules.Label.Minute")),1)]),_:1},8,["value","validator"])]),_:1},8,["label"])]),_:1})}}}),je=C({__name:"TabWeekly",props:{cron:{type:String,default:""},data:{type:Object,default:()=>({})}},emits:["update:cron"],setup(o,{emit:s}){const d=o,{t:p}=V(),{validator:_}=O(),v=[{label:"Sunday",value:0},{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6}],i=()=>{const r=d.data.repeatDay.join(",");s("update:cron",`${d.data.minute||0} ${d.data.hour||0} * * ${r||0}`)};return z(()=>{i()}),M(()=>{i()}),(r,a)=>{const g=G,h=D,x=F,k=A;return S(),$(k,{class:"mt-16px"},{default:n(()=>[t(h,{label:e(p)("Page.Schedules.Label.RepeatEvery")},{default:n(()=>[t(g,{value:o.data.repeatDay,"onUpdate:value":a[0]||(a[0]=y=>o.data.repeatDay=y),multiple:"",class:"w-300px",options:v},null,8,["value"])]),_:1},8,["label"]),t(h,{label:e(p)("Page.Schedules.Label.RepeatEveryWeekAt")},{default:n(()=>[t(x,{value:o.data.hour,"onUpdate:value":a[1]||(a[1]=y=>o.data.hour=y),max:23,min:0,class:"mr-16px",clearable:"","show-button":!1,validator:e(_)},null,8,["value","validator"]),f(" "+c(e(p)("Page.Schedules.Label.Hour"))+" ",1),t(x,{value:o.data.minute,"onUpdate:value":a[2]||(a[2]=y=>o.data.minute=y),class:"mx-16px",max:59,min:0,clearable:"","show-button":!1,validator:e(_)},null,8,["value","validator"]),f(" "+c(e(p)("Page.Schedules.Label.Minute")),1)]),_:1},8,["label"])]),_:1})}}}),Ne={class:"flex items-center gap-16px mb-16px"},Ee={class:"flex gap-2"},ze={key:0},Fe={class:"flex items-center"},He=C({__name:"TabMonthly",props:{cron:{type:String,default:""},data:{type:Object,default:()=>({})}},emits:["update:cron"],setup(o,{emit:s}){const d=o,{t:p}=V(),{validator:_}=O();function v(r){d.data.checkedValue=r.target.value}const i=()=>{const r=d.data.repeatDate.join(",");s("update:cron",`${d.data.minute||0} ${d.data.hour||0}  ${d.data.checkedValue==="lastDay"?31:r||1} */${d.data.repeat||0} *`)};return z(()=>{i()}),M(()=>{i()}),(r,a)=>{const g=se,h=G,x=D,k=we,y=F,B=A;return S(),$(B,{class:"mt-16px"},{default:n(()=>[m("div",Ne,[f(c(e(p)("Page.Schedules.Label.Customize"))+" ",1),t(g,{value:o.data.isCustom,"onUpdate:value":a[0]||(a[0]=b=>o.data.isCustom=b)},null,8,["value"])]),t(x,{label:e(p)("Page.Schedules.Label.RepeatEvery")},{default:n(()=>[m("div",Ee,[t(h,{value:o.data.repeat,"onUpdate:value":a[1]||(a[1]=b=>o.data.repeat=b),class:"w-300px",options:e(Pe)},null,8,["value","options"]),f(" "+c(e(p)("Page.Schedules.Label.Month")),1)])]),_:1},8,["label"]),o.data.isCustom?(S(),T("div",ze,[t(k,{class:"flex items-center mb-16px",checked:o.data.checkedValue==="inputDay",value:"inputDay",onChange:v},{default:n(()=>[m("div",Fe,c(e(p)("Page.Schedules.Label.RepeatOnDayInMonth")),1)]),_:1},8,["checked"]),t(h,{value:o.data.repeatDate,"onUpdate:value":a[2]||(a[2]=b=>o.data.repeatDate=b),disabled:o.data.checkedValue==="lastDay",multiple:"",class:"w-300px mb-16px",options:e(Te)},null,8,["value","disabled","options"]),t(k,{class:"flex items-center mb-16px",checked:o.data.checkedValue==="lastDay",value:"lastDay",onChange:v},{default:n(()=>[f(c(e(p)("Page.Schedules.Label.RepeatOnLastDayInMonth")),1)]),_:1},8,["checked"])])):E("",!0),o.data.isCustom?(S(),$(x,{key:1,label:"At"},{default:n(()=>[t(y,{value:o.data.hour,"onUpdate:value":a[3]||(a[3]=b=>o.data.hour=b),max:23,min:0,class:"mr-16px",clearable:"",validator:e(_),"show-button":!1},null,8,["value","validator"]),f(" "+c(e(p)("Page.Schedules.Label.Hour"))+" ",1),t(y,{value:o.data.minute,"onUpdate:value":a[4]||(a[4]=b=>o.data.minute=b),class:"mx-16px",max:59,min:0,clearable:"",validator:e(_),"show-button":!1},null,8,["value","validator"]),f(" "+c(e(p)("Page.Schedules.Label.Minute")),1)]),_:1})):E("",!0)]),_:1})}}}),Ie=C({__name:"TabOther",props:{cron:{type:String,default:""},data:{type:Object,default:()=>({})}},emits:["update:cron"],setup(o,{emit:s}){const d=()=>{window.open("https://crontab.guru")};return(p,_)=>{const v=ee,i=D,r=A,a=$e,g=q;return S(),T(W,null,[t(r,{class:"mt-16px"},{default:n(()=>[t(i,{label:"Cron"},{default:n(()=>[t(v,{value:o.cron,"onUpdate:value":_[0]||(_[0]=h=>s("update:cron",h))},null,8,["value"])]),_:1})]),_:1}),t(g,null,{default:n(()=>[f(" Learn more at "),t(a,{onClick:d},{default:n(()=>[f(" crontab.guru ")]),_:1})]),_:1})],64)}}}),Ke={class:"flex items-center gap-8px mt-24px"},We={class:"font-semibold text-lg"},qe={class:"font-semibold"},Ge={class:"mb-16px"},Ye={class:"flex items-center gap-8px"},Xe={class:"w-320px"},Je={key:1,class:"actions flex items-center gap-16px mt-32px"},Qe={key:2,class:"actions flex items-center gap-16px mt-32px"},Ze={key:0,class:"no-data mt-40px"},et={class:"flex flex-col justify-center items-center"},tt={class:"flex items-center gap-8px"},at={style:{color:"white"}},nt={key:1,class:"mt-24px"},lt={class:"flex items-center justify-between"},ot={class:"font-semibold"},st={class:"flex items-center gap-8px"},ut={style:{color:"white"}},dt={class:"flex flex-col gap-16px mt-24px"},rt={class:"flex items-center justify-between cursor-move my-2"},ct={class:"flex items-center gap-16px"},it={class:"font-semibold"},pt={class:"flex items-center gap-8px"},mt=C({__name:"ScheduleDetails",setup(o){const{t:s}=V(),{route:d,router:p}=ue(),_=J(()=>d.params.id),{activeTab:v,tasks:i,taskIds:r,schedule:a,startAt:g,nextRuns:h,resetSchedule:x,getScheduleDetails:k,createSchedule:y,updateSchedule:B}=O(),b=Q(!1),P=()=>{x(),p.push({name:"main.schedule"})},R=j=>{i.value=i.value.filter(l=>l.id!==j),r.value=r.value.filter(l=>l!==j)};return ve(async()=>{_.value==="new"?x():(await k(_.value),a.value.id||p.push({name:"main.schedule"}))}),(j,l)=>{const N=ee,Y=D,L=de,te=re,ae=Ce,H=q,ne=ce,le=Ue,U=ie,X=pe,oe=me;return S(),T(W,null,[m("div",Ke,[m("div",We,[t(Y,{label:"Name","show-feedback":!1},{default:n(()=>[t(N,{value:e(a).name,"onUpdate:value":l[0]||(l[0]=u=>e(a).name=u),autofocus:"",clearable:""},null,8,["value"])]),_:1})])]),t(X,{class:"mt-16px"},{default:n(()=>[m("div",qe,c(e(s)("Page.Schedules.Label.ScheduleSetup")),1),t(te,{value:e(v),"onUpdate:value":l[8]||(l[8]=u=>I(v)?v.value=u:null),"default-value":"minute",class:"mt-16px"},{default:n(()=>[t(L,{name:"minute",tab:e(s)("Page.Schedules.Tabs.Minute")},{default:n(()=>[t(Oe,{cron:e(a).cron,"onUpdate:cron":l[1]||(l[1]=u=>e(a).cron=u),data:e(a).config.minute},null,8,["cron","data"])]),_:1},8,["tab"]),t(L,{name:"hourly",tab:e(s)("Page.Schedules.Tabs.Hourly")},{default:n(()=>[t(Be,{cron:e(a).cron,"onUpdate:cron":l[2]||(l[2]=u=>e(a).cron=u),data:e(a).config.hourly},null,8,["cron","data"])]),_:1},8,["tab"]),t(L,{name:"daily",tab:e(s)("Page.Schedules.Tabs.Daily")},{default:n(()=>[t(Re,{cron:e(a).cron,"onUpdate:cron":l[3]||(l[3]=u=>e(a).cron=u),data:e(a).config.daily},null,8,["cron","data"])]),_:1},8,["tab"]),t(L,{name:"weekly",tab:e(s)("Page.Schedules.Tabs.Weekly")},{default:n(()=>[t(je,{cron:e(a).cron,"onUpdate:cron":l[4]||(l[4]=u=>e(a).cron=u),data:e(a).config.weekly},null,8,["cron","data"])]),_:1},8,["tab"]),t(L,{name:"monthly",tab:e(s)("Page.Schedules.Tabs.Monthly")},{default:n(()=>[t(He,{cron:e(a).cron,"onUpdate:cron":l[5]||(l[5]=u=>e(a).cron=u),data:e(a).config.monthly},null,8,["cron","data"])]),_:1},8,["tab"]),t(L,{cron:e(a).cron,"onUpdate:cron":l[7]||(l[7]=u=>e(a).cron=u),name:"other",tab:e(s)("Page.Schedules.Tabs.Other")},{default:n(()=>[t(Ie,{cron:e(a).cron,"onUpdate:cron":l[6]||(l[6]=u=>e(a).cron=u)},null,8,["cron"])]),_:1},8,["cron","tab"])]),_:1},8,["value"]),["minute","hourly"].includes(e(v))?(S(),$(Y,{key:0,label:"Start at"},{default:n(()=>[t(ae,{value:e(g),"onUpdate:value":l[9]||(l[9]=u=>I(g)?g.value=u:null),type:"datetime"},null,8,["value"])]),_:1})):E("",!0),m("div",Ge,[(S(!0),T(W,null,ge(e(h)(5),(u,K)=>(S(),T("div",{key:K},[t(H,{depth:"3"},{default:n(()=>[f(c(K+1)+". "+c(u),1)]),_:2},1024)]))),128))]),t(le,{checked:e(a).overridePreviousRun,"onUpdate:checked":l[10]||(l[10]=u=>e(a).overridePreviousRun=u)},{default:n(()=>[m("div",Ye,[f(c(e(s)("Page.Schedules.Label.SkipScheduleIfRunning"))+" ",1),t(ne,{trigger:"hover"},{trigger:n(()=>[t(w,{color:"#5671ff",class:"mr-8px cursor-pointer",type:"helpCircle",size:"large"})]),default:n(()=>[m("div",Xe,[m("div",null,c(e(s)("Page.Schedules.Label.SkipScheduleIfRunningDesc")),1)])]),_:1})])]),_:1},8,["checked"]),e(a).id?(S(),T("div",Qe,[t(U,{style:{color:"white"},type:"primary",onClick:l[13]||(l[13]=u=>e(B)())},{default:n(()=>[t(w,{class:"mr-8px",type:"play"}),f(" "+c(e(s)("Page.Schedules.Button.SaveAndClose")),1)]),_:1}),t(U,{quaternary:"",onClick:P},{default:n(()=>[f(c(e(s)("Common.Button.Cancel")),1)]),_:1})])):(S(),T("div",Je,[t(U,{style:{color:"white"},type:"primary",onClick:l[11]||(l[11]=u=>e(y)(!0))},{default:n(()=>[t(w,{class:"mr-8px",type:"play"}),f(" "+c(e(s)("Page.Schedules.Button.SaveAndActive")),1)]),_:1}),t(U,{ghost:"",type:"primary",onClick:l[12]||(l[12]=u=>e(y)())},{default:n(()=>[t(w,{class:"mr-8px",type:"save"}),f(" "+c(e(s)("Common.Button.Save")),1)]),_:1}),t(U,{quaternary:"",onClick:P},{default:n(()=>[f(c(e(s)("Common.Button.Cancel")),1)]),_:1})]))]),_:1}),e(i).length?E("",!0):(S(),T("div",Ze,[t(xe,null,{data:n(()=>[m("div",et,[m("div",null,[t(H,{class:"text-lg font-semibold"},{default:n(()=>[f(c(e(s)("Page.Schedules.Label.NoTaskTitle")),1)]),_:1})]),t(H,{depth:"3",class:"mt-12px"},{default:n(()=>[f(c(e(s)("Page.Schedules.Label.NoTaskSubTitle")),1)]),_:1}),t(U,{class:"mt-16px",type:"primary",onClick:l[14]||(l[14]=u=>b.value=!0)},{default:n(()=>[m("div",tt,[t(w,{type:"filePlus",color:"white"}),m("div",at,c(e(s)("Page.Schedules.Button.AddTask")),1)])]),_:1})])]),_:1})])),e(i).length>0?(S(),T("div",nt,[t(X,null,{default:n(()=>[m("div",lt,[m("div",null,[m("div",ot,c(e(s)("Page.Schedules.Label.Tasks")),1),m("div",null,[t(H,{depth:"3"},{default:n(()=>[f(c(e(s)("Page.Schedules.Label.TaskDesc")),1)]),_:1})])]),t(U,{class:"mt-16px",type:"primary",onClick:l[15]||(l[15]=u=>b.value=!0)},{default:n(()=>[m("div",st,[t(w,{type:"filePlus",color:"white"}),m("div",ut,c(e(s)("Page.Schedules.Button.AddTask")),1)])]),_:1})]),m("div",dt,[t(e(ke),{modelValue:e(i),"onUpdate:modelValue":l[16]||(l[16]=u=>I(i)?i.value=u:null),"item-key":"id"},{item:n(({element:u})=>[m("div",rt,[m("div",ct,[t(w,{color:"#5671FF",type:"folder",class:"icon",size:"16"}),m("div",it,c(u.name),1),t(oe,{size:"small",round:"",bordered:!1},{default:n(()=>[f(c(e(s)("Page.Schedules.Label.Task")),1)]),_:1})]),m("div",pt,[t(w,{class:"cursor-pointer",color:"#8C8C8C",type:"trash",onClick:K=>R(u.id)},null,8,["onClick"])])])]),_:1},8,["modelValue"])])]),_:1})])):E("",!0),t(Se,{"is-show":e(b),header:e(s)("Page.Schedules.Label.AddTaskTitle"),icon:"filePlus","is-show-actions":!1,onClose:l[19]||(l[19]=u=>b.value=!1)},{body:n(()=>[t(e(Ve),{"model-value":e(r),"onUpdate:modelValue":l[17]||(l[17]=u=>I(r)?r.value=u:null),onSelect:l[18]||(l[18]=u=>i.value=u)},null,8,["model-value"])]),_:1},8,["is-show","header"])],64)}}});const Nt=be(mt,[["__scopeId","data-v-8f469aa5"]]);export{Nt as default};
