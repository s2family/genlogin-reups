import{a2 as Ve,bW as We,bh as r,bi as De,bf as Fe,bg as _,bj as be,aL as R,ah as Ge,bX as Me,br as ve,bs as Le,bw as Ke,X as Be,f_ as L,f$ as J,am as ze,a7 as He,a8 as je,bu as qe,a9 as Je,bx as Qe}from"./main-8b08e1d6.js";import{r as K}from"./index-35523669.js";import{l as B}from"./lodash-6114c6d4.js";import{d as Ze,r as Te,c as z,b as ae,w as et,S as v,X as E,Y as i,D as o,u as e,E as C,U,F as W,ad as Ie,$ as I,a2 as D,V as p,q as Oe,h as Q}from"./_plugin-vue_export-helper-b059e461.js";import{_ as tt}from"./Scrollbar-e90e60b7.js";import{_ as at}from"./Select-f7c79767.js";import{_ as nt}from"./FormItemGridItem-951b0746.js";import{a as ot}from"./Grid-308f499b.js";import{_ as lt}from"./Input-96fa4693.js";import{_ as st}from"./Checkbox-ce86da58.js";import{_ as rt}from"./Pagination-ce77c3f3.js";import{_ as pt}from"./Progress-0b0a0198.js";import{_ as it}from"./InputNumber-c85d5887.js";import{_ as ct}from"./FormItem-52ed65a1.js";import{_ as ut}from"./a-72358bba.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";import"./Suffix-fc59bb7a.js";import"./Remove-be3cc84a.js";const dt={class:"flex gap-2"},_t={class:"text-green-500"},yt={class:"text-red-500"},ft=p("span",null,"Example:",-1),mt=p("span",null,"http://192.168.1.1:3000:user:password|http://yourchangeipurl|delayOpen(seconds)",-1),ht=p("span",null,"http://192.168.1.1:3000:user:password",-1),gt=p("span",null,"socks4://192.168.1.1:3000",-1),xt=p("span",null,"socks5://192.168.1.1:3000",-1),Pt=p("span",{class:"cursor-pointer select-none"}," Change IP when start profile ",-1),bt=p("span",null,"Format:",-1),vt=p("span",null,[p("strong",null,"TM"),C(" : api_key:location ")],-1),Tt=p("span",null,[p("strong",null,"Tinsoft"),C(" : api_key:location ")],-1),It=p("span",null,[p("strong",null,"Tin"),C(" : api_key ")],-1),Ot=p("hr",null,null,-1),Ct={class:"my-2 flex gap-2"},kt={class:"cursor-pointer select-none"},wt={key:0},Rt={class:"gap-5 flex"},St={class:"w-1/2"},Nt={class:"flex items-center justify-between"},Et={class:"font-semibold"},Ut={class:"my-2 flex gap-2"},At={class:"cursor-pointer select-none"},Yt={key:0},$t={class:"gap-5 flex"},Xt={class:"w-1/2"},Vt={class:"flex items-center justify-between"},Wt={class:"font-semibold"},Dt={class:"my-2 flex gap-2"},Ft={class:"cursor-pointer select-none"},ra=Ze({__name:"UpdateProfilesProxyModal",props:{modelShow:{type:Boolean,default:!1},profiles:{type:Array,default:()=>[]}},emits:["update:show","success"],setup(F,{emit:ne}){var ue;const Ce=F,{t:G}=Ve(),{proxyServiceCheckerOptions:Z}=We(),ke=[{label:"No Proxy",value:r.WITHOUT},{label:"Common",value:"Common"},{label:"Gen Proxy",value:r.GEN_PROXY},{label:"TM Proxy",value:r.TM},{label:"Tinsoft Proxy",value:r.TINSOFT},{label:"Tin Proxy",value:r.TIN},{label:"Kiot Proxy",value:r.KIOT_PROXY},{label:"F Proxy",value:r.F_PROXY},{label:"WW Proxy",value:r.WW_PROXY},{label:"Net Proxy",value:r.NET_PROXY}],y=Te({applyForAll:!1,proxy:null}),oe=z(()=>De),{defaultParams:le,proxies:we,pagination:Re,getProxies:Se,onPageUpdate:Ne}=Fe(),se=z(()=>we.value.map(n=>{const{id:t,extras:{type:c,protocol:d,capacity:x,remain:P,unit:m,custom:s,host:f,port:u}}=n;let{extras:{name:h}}=n;return c!==_.IMPORT&&(h=`${f}:${u} - ${h}`),c===_.KENT_PROXY&&s.loaiproxy&&(h=`${h} - ${s.loaiproxy}`),{value:t,label:h,type:c,protocol:d,capacity:x,remain:P,unit:m,country:s?s.country:void 0,host:f,port:u,name:h}})),re=n=>{const{label:t,flag:c}=n;return Q(R,{align:"center"},{default:()=>[...c?[Q(ve,{country:c})]:[],t]})},pe=n=>{var x;let t="",c="";const d=`${n.name} - `;switch(n.type){case _.IMPORT:return c=n.label.toString(),t=` - ${n.protocol}`,`${c}${t}`;case _.DYNAMIC:return c="Proxy rotate",t=` - ${n.remain}/${n.capacity}${n.unit}`,`${c}${t}`;case _.VINA_PROXY_V4:case _.VINA_PROXY_DATA_CENTER:case _.STATIC_V4:case _.STATIC_ISP:case _.KENT_PROXY:n.type===_.STATIC_V4?c="IPv4 proxy":n.type===_.STATIC_ISP?c="ISP proxy":n.type===_.VINA_PROXY_V4?(n.country="VIETNAM",c="Vietnam proxy"):n.type===_.VINA_PROXY_DATA_CENTER?(n.country="VIETNAM",c="Vietnam proxy data center"):n.type===_.KENT_PROXY&&(n.country="VIETNAM",c="Economical Vietnam residential Proxy"),t=` - ${n.country}`;let P=null;return[_.VINA_PROXY_V4,_.VINA_PROXY_DATA_CENTER,_.KENT_PROXY].includes(n.type)?P="vn":P=(x=Le.find(m=>{var s;return m.value===((s=n.country)==null?void 0:s.toUpperCase())}))==null?void 0:x.flag,Q(R,{align:"center"},{default:()=>[...P?[Q(ve,{country:P})]:[],`${d}${c}${t}`]})}},b=ae({}),ie=async n=>(await Qe(n)).data.data,Ee=async(n,t)=>{if(!t){delete b.value[n];return}const c=await ie(t),{extras:d}=c;b.value[n]={id:t,extras:d,stickyTime:0,changeIpOnStartup:!1,country:null}},Ue=async(n,t)=>{b.value[n]&&(b.value[n].country=t)},Ae=async n=>{if(!n){y.proxy=null;return}const t=await ie(n),{extras:c}=t;y.proxy={id:n,extras:c,stickyTime:0,changeIpOnStartup:!1,country:null}},Ye=async n=>{y.proxy&&(y.proxy.country=n)},Y=ae(""),a=Te({type:"Common",webRTC:be.ALTER_NONE_EXISTS,loading:!1,changeIpOnStartup:!1,enableChangeIp:!1,updatedProfiles:[],failedProfiles:[]}),k=ae(((ue=Z.value[0])==null?void 0:ue.name)||null),ee=z(()=>Y.value.length?Y.value.trim().split(`
`):[]),ce=()=>{var n;Y.value="",Object.assign(a,{type:"Common",webRTC:be.ALTER_NONE_EXISTS,loading:!1,changeIpOnStartup:!1,updatedProfiles:[],failedProfiles:[]}),y.applyForAll=!1,y.proxy=null,k.value=((n=Z.value[0])==null?void 0:n.name)||null,ne("update:show",!1)},te=z(()=>n=>{const t=ee.value.length===1?ee.value[0]:ee.value[n];if(a.type===r.WITHOUT)return"";if(!t)return"-";if(a.type==="Common"){if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("socks5://")||t.startsWith("socks4://"))return t}else return t;return`http://${t}`}),$e=async(n=!1)=>{if(!a.loading)try{a.loading=!0,a.updatedProfiles=[],a.failedProfiles=[];let t;a.type===r.WITHOUT&&(t=await Ke({protocol:void 0,type:r.WITHOUT,host:"",port:"",login:"",password:"",service:k.value}));const c=Be(Ce.profiles,100);if(a.type===r.WITHOUT){const{ip:d,timezone:x,latitude:P,longitude:m}=t.data.data,s={proxy:{type:r.WITHOUT,options:{service:k.value,enableChangeIp:a.enableChangeIp},proxyInfo:{}},timezone:x,geolocation:{lng:m,lat:P},webRTC:{ip:d,type:a.webRTC},delayOpen:void 0},f=K.createPatch({},s);for(const u of c){const h=u.chunk.map(g=>g.id),O=u.chunk.map(g=>L(B.cloneDeep(f),g.id)).flat(),{data:{data:{profile_ids:T}}}=await J(O);T.forEach(g=>{h.includes(g)?a.updatedProfiles.push(g):a.failedProfiles.push(g)})}}else if(a.type==="Common")for(const d of c){const x=d.chunk.map(s=>s.id),P=d.chunk.map((s,f)=>{let u=te.value(d.indices[f]),h;if(u!=="-"){u.startsWith("http://")?u=u.replace("http://",`${r.HTTP}:`):u.startsWith("https://")?u=u.replace("https://",`${r.HTTP}:`):u.startsWith("socks4://")?u=u.replace("socks4://",`${r.SOCKS4}:`):u.startsWith("socks5://")&&(u=u.replace("socks5://",`${r.SOCKS5}:`));const[O,T="",g]=u.split("|"),[S="",w="",$="",M="",A=""]=O.trim().split(":"),X={proxy:{type:S,host:w,port:$.toString(),login:M,password:A,options:{changeIpUrl:T,service:k.value,enableChangeIp:a.enableChangeIp,apiKey:"",changeIpOnStartup:null,location:null},proxyInfo:{}},webRTC:{type:a.webRTC},delayOpen:g?parseInt(g):void 0},V=K.createPatch({proxy:{options:{changeIpUrl:null,service:null,enableChangeIp:null,apiKey:"",changeIpOnStartup:null,location:null},proxyInfo:{}},webRTC:{type:null}},X);h=L(B.cloneDeep(V),s.id)}else{const O={proxy:{options:{service:k.value}},webRTC:{type:a.webRTC}},T=K.createPatch({proxy:{options:{service:null}},webRTC:{type:null}},O);h=L(B.cloneDeep(T),s.id)}return h}).flat().filter(Boolean),{data:{data:{profile_ids:m}}}=await J(P);m.forEach(s=>{x.includes(s)?a.updatedProfiles.push(s):a.failedProfiles.push(s)})}else if(a.type===r.GEN_PROXY)for(const d of c){const x=d.chunk.map(s=>s.id),P=d.chunk.map(s=>{if(!y.applyForAll&&!b.value[s.id])return!1;let f=null;y.applyForAll?f=y.proxy:f=b.value[s.id];const{id:u,extras:h,stickyTime:O}=f;let{country:T}=f;const{type:g,protocol:S,custom:w,host:$,port:M,username:A,password:X}=h;[_.VINA_PROXY_V4,_.VINA_PROXY_DATA_CENTER,_.KENT_PROXY].includes(g)?T="VIETNAM":g===_.IMPORT?T=null:T=w?w.country.toUpperCase():T.toUpperCase();const V={id:u,type:h.type,protocol:S.toLowerCase(),country:T,stickyTime:O},H={proxy:{type:r.GEN_PROXY,host:$,port:M.toString(),login:A,password:X,options:{service:k.value},genProxy:V,proxyInfo:{}},webRTC:{type:a.webRTC},delayOpen:void 0},j=K.createPatch({},H);return L(B.cloneDeep(j),s.id)}).flat().filter(Boolean),{data:{data:{profile_ids:m}}}=await J(P);m.forEach(s=>{x.includes(s)?a.updatedProfiles.push(s):a.failedProfiles.push(s)})}else{let d=0;switch(a.type){case r.GEN_PROVIDER_PROXY:case r.TM:d=1;break;case r.TINSOFT:d=0;break;case r.NET_PROXY:d="all";break;default:break}for(const x of c){const P=x.chunk.map(f=>f.id),m=x.chunk.map((f,u)=>{const h=te.value(x.indices[u]),[O,T=""]=h.split(":"),g={proxy:{type:a.type,options:{apiKey:O,location:parseInt(T)||d,service:k.value,changeIpOnStartup:a.changeIpOnStartup},proxyInfo:{}},webRTC:{type:a.webRTC},delayOpen:void 0},S=K.createPatch({},g);return L(B.cloneDeep(S),f.id)}).flat(),{data:{data:{profile_ids:s}}}=await J(m);s.forEach(f=>{P.includes(f)?a.updatedProfiles.push(f):a.failedProfiles.push(f)})}}n&&(window.$message.success("Profiles(s) updated"),ne("success"))}catch{window.$message.warning("Profile(s) update failed")}finally{a.loading=!1}},Xe=z(()=>a.type==="Common"?"host:port:login:password|changeIpUrl":"");return et(()=>a.type,async n=>{n===r.GEN_PROXY&&await Se()}),(n,t)=>{const c=ze,d=He,x=je,P=tt,m=at,s=nt,f=ot,u=lt,h=st,O=qe,T=rt,g=pt,S=it,w=ct,$=ut,M=Je;return v(),E(M,{show:F.modelShow,title:"Update proxy",style:{width:"50%"},"transform-origin":"center","mask-closable":!1,preset:"dialog",onClose:ce},{action:i(()=>[o(e(R),null,{default:i(()=>[o(c,{size:"small",disabled:e(a).loading,onClick:ce},{default:i(()=>[C(" Cancel ")]),_:1},8,["disabled"]),o(c,{size:"small",type:"primary",disabled:e(a).loading,loading:e(a).loading,onClick:t[0]||(t[0]=A=>$e(!0))},{default:i(()=>[C(" Update ")]),_:1},8,["disabled","loading"])]),_:1})]),default:i(()=>[o(e(R),{vertical:""},{default:i(()=>{var A,X,V,H,j,de,_e;return[o(P,{style:{"max-height":"240px"},trigger:"hover"},{default:i(()=>[(v(!0),U(W,null,Ie(F.profiles,(l,q)=>(v(),E(x,{key:q,class:"mb-1",size:"small","content-style":"padding: 10px"},{default:i(()=>[o(e(R),{justify:"space-between"},{default:i(()=>[o(d,{strong:""},{default:i(()=>[C(I(l.name)+" ",1),e(a).updatedProfiles.includes(l.id)?(v(),E(Ge,{key:0,type:"check",color:"#0e7a0d",size:"20",class:"relative top-1"})):D("",!0),e(a).failedProfiles.includes(l.id)?(v(),E(d,{key:1,type:"error"},{default:i(()=>[C(" Error ")]),_:1})):D("",!0)]),_:2},1024)]),_:2},1024),p("span",null,I(e(te)(q)),1)]),_:2},1024))),128))]),_:1}),p("div",dt,[p("span",null," Total: "+I(F.profiles.length),1),e(a).loading?(v(),U(W,{key:0},[p("span",_t," Updated "+I(e(a).updatedProfiles.length),1),p("span",yt," Failed "+I(e(a).failedProfiles.length),1)],64)):D("",!0)]),o(f,{cols:"12","y-gap":"5","x-gap":"12"},{default:i(()=>[o(s,{span:4,label:"Connection type","show-feedback":!1},{default:i(()=>[o(m,{value:e(a).type,"onUpdate:value":t[1]||(t[1]=l=>e(a).type=l),options:ke},null,8,["value"])]),_:1}),o(s,{span:4,label:"Service","show-feedback":!1},{default:i(()=>[o(m,{value:e(k),"onUpdate:value":t[2]||(t[2]=l=>Oe(k)?k.value=l:null),options:e(Z),"value-field":"name","label-field":"label",placeholder:""},null,8,["value","options"])]),_:1}),o(s,{span:4,label:"WebRTC","show-feedback":!1},{default:i(()=>[o(m,{value:e(a).webRTC,"onUpdate:value":t[3]||(t[3]=l=>e(a).webRTC=l),options:e(Me)},null,8,["value","options"])]),_:1})]),_:1}),["Common",e(r).TIN,e(r).GEN_PROVIDER_PROXY,e(r).TM,e(r).TINSOFT,e(r).KIOT_PROXY,e(r).F_PROXY,e(r).WW_PROXY,e(r).NET_PROXY].includes(e(a).type)?(v(),U(W,{key:0},[o(u,{value:e(Y),"onUpdate:value":t[4]||(t[4]=l=>Oe(Y)?Y.value=l:null),type:"textarea",autosize:{minRows:5,maxRows:5},placeholder:e(Xe)},null,8,["value","placeholder"]),o(h,{checked:e(a).enableChangeIp,"onUpdate:checked":t[5]||(t[5]=l=>e(a).enableChangeIp=l)},{default:i(()=>[C(" Enable change Ip ")]),_:1},8,["checked"]),e(a).type==="Common"?(v(),E(e(R),{key:0,vertical:""},{default:i(()=>[ft,mt,ht,gt,xt]),_:1})):(v(),E(e(R),{key:1,vertical:""},{default:i(()=>[o(e(R),null,{default:i(()=>[o(O,{value:e(a).changeIpOnStartup,"onUpdate:value":t[6]||(t[6]=l=>e(a).changeIpOnStartup=l)},null,8,["value"]),Pt]),_:1}),bt,vt,Tt,It]),_:1}))],64)):e(a).type===e(r).GEN_PROXY?(v(),U(W,{key:1},[Ot,p("div",Ct,[o(O,{value:e(y).applyForAll,"onUpdate:value":t[7]||(t[7]=l=>e(y).applyForAll=l)},null,8,["value"]),p("span",kt,I(e(G)("Page.CreateProfile.Tabs.Network.Label.ApplyForAll")),1)]),e(y).applyForAll?(v(),U(W,{key:0},[o(m,{options:e(se),filterable:"",clearable:"","render-label":pe,placeholder:"Select gen proxy",onUpdateValue:Ae},{action:i(()=>[o(T,{page:e(le).page,"page-count":Math.ceil(e(Re).count/e(le).size),"on-update:page":e(Ne)},null,8,["page","page-count","on-update:page"])]),_:1},8,["options"]),((X=(A=e(y).proxy)==null?void 0:A.extras)==null?void 0:X.type)===e(_).DYNAMIC?(v(),U("div",wt,[p("div",Rt,[p("div",St,[p("div",Nt,[C(" Usage "),p("div",Et,I((V=e(y).proxy)==null?void 0:V.extras.remain)+" / "+I((H=e(y).proxy)==null?void 0:H.extras.capacity)+" "+I((j=e(y).proxy)==null?void 0:j.extras.unit),1)]),o(g,{class:"mt-4px",type:"line",percentage:((de=e(y).proxy)==null?void 0:de.extras.remain)/((_e=e(y).proxy)==null?void 0:_e.extras.capacity)*100,"show-indicator":!1},null,8,["percentage"]),o(w,{class:"w-full",label:e(G)("Page.CreateProfile.Tabs.Network.Label.StickyTime"),"show-feedback":!1},{default:i(()=>[o(S,{value:e(y).proxy.stickyTime,"onUpdate:value":t[8]||(t[8]=l=>e(y).proxy.stickyTime=l),placeholder:"Default random IP",max:90},null,8,["value"])]),_:1},8,["label"])]),o($,{onClick:t[9]||(t[9]=l=>n.$router.push({name:"main.proxy"}))},{default:i(()=>[C(" Buy Proxy ")]),_:1})]),o(w,{class:"mt-2",label:"Country","show-feedback":!1},{default:i(()=>[o(m,{placeholder:"Select Proxy country",options:e(oe),filterable:"",clearable:"","render-label":re,onUpdateValue:Ye},null,8,["options"])]),_:1}),p("div",Ut,[o(O,{value:e(y).proxy.changeIpOnStartup,"onUpdate:value":t[10]||(t[10]=l=>e(y).proxy.changeIpOnStartup=l)},null,8,["value"]),p("span",At,I(e(G)("Page.CreateProfile.Tabs.Network.Label.ChangeIpOnStart")),1)])])):D("",!0)],64)):(v(),E(P,{key:1,style:{"max-height":"240px","margin-bottom":"20px"},trigger:"hover"},{default:i(()=>[o(e(R),{vertical:"",class:"w-full"},{default:i(()=>[(v(!0),U(W,null,Ie(F.profiles,(l,q)=>(v(),E(x,{key:q,size:"small"},{default:i(()=>{var ye,fe,me,he,ge,xe,Pe;return[o(d,null,{default:i(()=>[C(I(l.name),1)]),_:2},1024),o(m,{options:e(se),filterable:"",clearable:"","render-label":pe,placeholder:"Select gen proxy",onUpdateValue:N=>Ee(l.id,N)},null,8,["options","onUpdateValue"]),((fe=(ye=e(b)[l.id])==null?void 0:ye.extras)==null?void 0:fe.type)===e(_).DYNAMIC?(v(),U("div",Yt,[p("div",$t,[p("div",Xt,[p("div",Vt,[C(" Usage "),p("div",Wt,I((me=e(b)[l.id])==null?void 0:me.extras.remain)+" / "+I((he=e(b)[l.id])==null?void 0:he.extras.capacity)+" "+I((ge=e(b)[l.id])==null?void 0:ge.extras.unit),1)]),o(g,{class:"mt-4px",type:"line",percentage:((xe=e(b)[l.id])==null?void 0:xe.extras.remain)/((Pe=e(b)[l.id])==null?void 0:Pe.extras.capacity)*100,"show-indicator":!1},null,8,["percentage"]),o(w,{class:"w-full",label:e(G)("Page.CreateProfile.Tabs.Network.Label.StickyTime"),"show-feedback":!1},{default:i(()=>[o(S,{value:e(b)[l.id].stickyTime,"onUpdate:value":N=>e(b)[l.id].stickyTime=N,placeholder:"Default random IP",max:90},null,8,["value","onUpdate:value"])]),_:2},1032,["label"])]),o($,{onClick:t[11]||(t[11]=N=>n.$router.push({name:"main.proxy"}))},{default:i(()=>[C(" Buy Proxy ")]),_:1})]),o(w,{class:"mt-2",label:"Country","show-feedback":!1},{default:i(()=>[o(m,{placeholder:"Select Proxy country",options:e(oe),filterable:"",clearable:"","render-label":re,onUpdateValue:N=>Ue(l.id,N)},null,8,["options","onUpdateValue"])]),_:2},1024),p("div",Dt,[o(O,{value:e(b)[l.id].changeIpOnStartup,"onUpdate:value":N=>e(b)[l.id].changeIpOnStartup=N},null,8,["value","onUpdate:value"]),p("span",Ft,I(e(G)("Page.CreateProfile.Tabs.Network.Label.ChangeIpOnStart")),1)])])):D("",!0)]}),_:2},1024))),128))]),_:1})]),_:1}))],64)):D("",!0)]}),_:1})]),_:1},8,["show"])}}});export{ra as default};
