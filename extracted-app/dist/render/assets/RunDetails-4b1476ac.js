import{a2 as V,dK as z,a_ as w,ah as C,am as B,ar as ae,a8 as Q,aq as oe,I as se,ad as ne,ao as le,aY as ie,a7 as Z,a0 as ue,a1 as de,G as re,aU as pe,bE as ce,aV as _e,ai as me}from"./main-8b08e1d6.js";import X from"./ModalConfirm-92ee844f.js";import{u as M}from"./useRunScript-b4e924db.js";import{u as j}from"./useConsole-dd6c2120.js";import{_ as fe}from"./InputSearch.vue_vue_type_script_setup_true_lang-d786940a.js";import{_ as ee}from"./DataTable.vue_vue_type_style_index_0_lang-cdaf49f4.js";import{d as O,c as K,b as E,m as q,o as Y,S as k,U as G,V as a,D as t,u as e,Y as o,E as u,$ as l,a2 as U,q as H,F as te,a1 as W,ab as ge,ac as ve,X as L,a8 as J}from"./_plugin-vue_export-helper-b059e461.js";import{_ as be}from"./Select-f7c79767.js";import{_ as ye}from"./ExportRunDataModal.vue_vue_type_script_setup_true_lang-39850a89.js";import{_ as xe}from"./Divider-65f3d898.js";import{_ as Re}from"./RunLog.vue_vue_type_script_setup_true_lang-0ef9ae68.js";import"./lodash-6114c6d4.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";import"./a-72358bba.js";import"./Input-96fa4693.js";import"./Suffix-fc59bb7a.js";import"./DataTable-e5054828.js";import"./Checkbox-ce86da58.js";import"./RadioGroup-69a7fbba.js";import"./Radio-c980589e.js";import"./Pagination-ce77c3f3.js";import"./FormItem-52ed65a1.js";const he={class:"flex items-center gap-24px"},ke={key:0,class:"actions pt-16px flex gap-8px"},we={class:"flex items-center gap-8px"},Pe={class:"flex items-center gap-8px"},Ce={class:"flex items-center gap-8px"},Se={class:"mt-2 table-data"},Ne=O({__name:"RunProfiles",setup(N){const{t:s}=V(),{loading:c,taskRun:_,reRunTaskRun:$}=M(),{defaultProfilesParams:i,profiles:f,tags:b,profilePagination:S,taskProfileColumns:h,getTaskRunProfiles:v,getTaskRunTags:I,onTaskRunProfilesPageUpdate:P,onTaskRunProfilesPageSizeUpdate:m,onSortChange:y}=j(),p=K(()=>[{label:s("Common.Label.All"),value:""},{label:s("Common.Label.Pending"),value:z.PENDING},{label:s("Common.Label.Running"),value:z.RUNNING},{label:s("Common.Label.Success"),value:z.SUCCESS},{label:s("Common.Label.Aborted"),value:z.ABORTED},{label:s("Common.Label.Failed"),value:z.FAIL}]),d=E([]),r=E(null),R=()=>Promise.all([v(_.value.id),I(_.value.id)]),g=async D=>{await navigator.clipboard.writeText(D.join(`
`)),window.$message.success(s("Common.Noti.Copied"))},T=async D=>{const n=f.value.filter(A=>D.includes(A.profileId)).map(A=>A.profileName);await navigator.clipboard.writeText(n.join(`
`)),window.$message.success(s("Common.Noti.Copied"))};q(async()=>{await R(),r.value=setInterval(()=>{_.value.status===w.RUNNING&&R()},2e3)});const F=async()=>{d.value=[],await v(_.value.id)};return Y(()=>{clearInterval(r.value)}),(D,n)=>{const A=be;return k(),G(te,null,[a("div",he,[t(fe,{value:e(i).name,"onUpdate:value":n[0]||(n[0]=x=>e(i).name=x),class:"!w-auto",placeholder:e(s)("Common.Label.Search"),clearable:"","on-input":()=>e(v)(e(_).id)},null,8,["value","placeholder","on-input"]),t(A,{value:e(i).status,"onUpdate:value":n[1]||(n[1]=x=>e(i).status=x),placeholder:e(s)("Page.AutomationRuns.Label.ProfileStatus"),class:"w-150px",options:e(p),onUpdateValue:n[2]||(n[2]=()=>F())},null,8,["value","placeholder","options"]),t(A,{value:e(i).tag,"onUpdate:value":n[3]||(n[3]=x=>e(i).tag=x),placeholder:"Tags",class:"w-150px",options:e(b),clearable:"",onUpdateValue:n[4]||(n[4]=()=>F())},null,8,["value","options"])]),e(d).length>0&&![e(w).PENDING,e(w).RUNNING].includes(e(_).status)?(k(),G("div",ke,[t(e(B),{disabled:e(c),loading:e(c),type:"primary",onClick:n[5]||(n[5]=x=>e($)(e(_).id,e(d)))},{default:o(()=>[a("div",we,[t(C,{type:"play"}),u(" "+l(e(s)("Page.AutomationRuns.Button.RerunWithProfiles",{number:e(d).length})),1)])]),_:1},8,["disabled","loading"]),t(e(B),{disabled:e(c),type:"success",ghost:"",onClick:n[6]||(n[6]=x=>g(e(d)))},{default:o(()=>[a("div",Pe,[t(C,{type:"copy"}),u(" "+l(e(s)("Page.AutomationRuns.Button.CopyProfileIDs",{number:e(d).length})),1)])]),_:1},8,["disabled"]),t(e(B),{disabled:e(c),type:"success",ghost:"",onClick:n[7]||(n[7]=x=>T(e(d)))},{default:o(()=>[a("div",Ce,[t(C,{type:"copy"}),u(" "+l(e(s)("Page.AutomationRuns.Button.CopyProfileNames",{number:e(d).length})),1)])]),_:1},8,["disabled"])])):U("",!0),a("div",Se,[t(e(ee),{"checked-row-keys":e(d),"onUpdate:checkedRowKeys":n[8]||(n[8]=x=>H(d)?d.value=x:null),class:"mt-2",data:e(f),columns:e(h),pagination:e(S),"row-key":x=>x.profileId,"on-page-update":e(P),"on-page-size-update":e(m),onUpdateSorter:e(y)},null,8,["checked-row-keys","data","columns","pagination","row-key","on-page-update","on-page-size-update","onUpdateSorter"])])],64)}}});const $e=W(Ne,[["__scopeId","data-v-97af6d6c"]]),Ie=N=>(ge("data-v-74de07ff"),N=N(),ve(),N),De={class:"mt-2 table-data"},Te={class:"actions w-full"},Ae={class:"flex items-center gap-16px p-16px"},Ue=Ie(()=>a("div",{style:{color:"#fff"}}," Export ",-1)),Le=O({__name:"RunOutput",setup(N){const{taskRun:s}=M(),{goAppDetails:c}=ae(),{loading:_,storageData:$,storagePagination:i,getStorageData:f,onStorageDataPageSizeUpdate:b,onStorageDataPageUpdate:S}=j(),h=K(()=>{var m,y,p,d;const P=[{title:"#",width:"5%",key:"index",render(r,R){return R}}];return(y=(m=s.value)==null?void 0:m.app)!=null&&y.table?[...P,...(d=(p=s.value)==null?void 0:p.app)==null?void 0:d.table.map(r=>({title:r.name,key:r.name,resizable:!0,ellipsis:{tooltip:!0},render(R){return R.data[r.name]}}))]:[]}),v=E(!1),I=E(null);return q(async()=>{await f(s.value.id),I.value=setInterval(()=>{s.value.status===w.RUNNING&&f(s.value.id)},2e3)}),Y(()=>{clearInterval(I.value)}),(P,m)=>{const y=xe,p=B,d=Q;return k(),G(te,null,[a("div",De,[t(e(ee),{loading:e(_),"max-height":"45vh","scroll-x":2500,data:e($),columns:e(h),pagination:e(i),"row-key":r=>r.id,"on-page-update":e(S),"on-page-size-update":e(b)},null,8,["loading","scroll-x","data","columns","pagination","row-key","on-page-update","on-page-size-update"])]),a("div",Te,[t(d,null,{default:o(()=>[t(y),a("div",Ae,[t(p,{type:"primary",onClick:m[0]||(m[0]=r=>v.value=!0)},{default:o(()=>[t(C,{color:"#fff",class:"mr-8px",type:"IExport"}),Ue]),_:1}),t(p,{type:"primary",ghost:"",onClick:m[1]||(m[1]=r=>e(c)(e(s).appId))},{default:o(()=>[t(C,{class:"mr-8px",type:"boxBold"}),u(" Go to App ")]),_:1})])]),_:1})]),t(ye,{"model-show":e(v),"onUpdate:modelShow":m[2]||(m[2]=r=>H(v)?v.value=r:null),"run-id":e(s).id},null,8,["model-show","run-id"])],64)}}});const Be=W(Le,[["__scopeId","data-v-74de07ff"]]),Fe={class:"flex items-center gap-8px"},ze={class:"flex items-center justify-between mx-16px my-12px"},Ee={class:"flex flex-col gap-8px"},Ge={class:"font-bold"},Me={class:"flex flex-col gap-8px"},Oe={class:"font-bold"},Ve={class:"flex flex-col gap-8px"},je={class:"font-bold"},Ke={class:"flex flex-col gap-8px"},qe={class:"font-bold"},Ye={class:"console mt-2"},He={class:"flex items-center gap-4px"},We={class:"log-number"},Xe=O({__name:"RunStatus",setup(N){const{t:s}=V(),{taskRun:c,totalProfiles:_,finishedProfiles:$,failedProfiles:i,totalOutputData:f}=M(),{duration:b,formatDateTime:S}=oe(),{activeTab:h}=j(),{isDarkMode:v}=se(ne());return(I,P)=>{const m=le,y=ie,p=Z,d=Q,r=ue,R=de;return e(c)?(k(),L(m,{key:0,show:e(c)===null},{default:o(()=>[t(d,{class:"mt-16px overview-container"},{default:o(()=>[a("div",{class:"header",style:J({"--bg-color":e(v)?"#3C3C3C":"#F8F9FF"})},[e(c).status===e(w).RUNNING?(k(),L(y,{key:0,bordered:!1,type:"info",size:"large"},{default:o(()=>[a("div",Fe,[t(m,{size:"small"},{icon:o(()=>[t(C,{type:"loading",color:"primary"})]),_:1}),u(" "+l(e(s)("Common.Label.Running")),1)])]),_:1})):U("",!0),e(c).status===e(w).FINISHED?(k(),L(y,{key:1,bordered:!1,type:"success",size:"large"},{default:o(()=>[u(l(e(s)("Common.Label.Finished")),1)]),_:1})):U("",!0),e(c).status===e(w).ABORTED?(k(),L(y,{key:2,bordered:!1,type:"error",size:"large"},{default:o(()=>[u(l(e(s)("Common.Label.Aborted")),1)]),_:1})):U("",!0)],4),a("div",ze,[a("div",Ee,[a("div",null,[t(p,{depth:"2"},{default:o(()=>[u(l(e(s)("Page.AutomationRuns.Label.Results")),1)]),_:1})]),a("div",Ge,[t(p,null,{default:o(()=>[u(l(e(f)),1)]),_:1})])]),a("div",Me,[a("div",null,[t(p,{depth:"2"},{default:o(()=>[u(l(e(s)("Page.AutomationRuns.Label.Profiles")),1)]),_:1})]),a("div",Oe,[t(p,null,{default:o(()=>[u(l(e(s)("Page.AutomationRuns.Label.TaskRunProfileStats",{handled:e($)+e(i),total:e(_)})),1)]),_:1})])]),a("div",Ve,[a("div",null,[t(p,{depth:"2"},{default:o(()=>[u(l(e(s)("Page.AutomationRuns.Label.StartedAt")),1)]),_:1})]),a("div",je,[t(p,null,{default:o(()=>[u(l(e(S)(e(c).createdAt)),1)]),_:1})])]),a("div",Ke,[a("div",null,[t(p,{depth:"2"},{default:o(()=>[u(l(e(s)("Page.AutomationRuns.Label.Duration")),1)]),_:1})]),a("div",qe,[t(p,null,{default:o(()=>[u(l(e(b)(e(c).createdAt,e(c).finishedAt)),1)]),_:1})])])])]),_:1}),a("div",Ye,[t(R,{value:e(h),"onUpdate:value":P[0]||(P[0]=g=>H(h)?h.value=g:null),style:J({"--number-bg-color":e(v)?"#262626":"#F0F0F0"})},{default:o(()=>[t(r,{name:"output",tab:"Output"},{default:o(()=>[t(Be)]),_:1}),t(r,{name:"log",tab:"Logs"},{default:o(()=>[t(Re)]),_:1}),t(r,{name:"profiles"},{tab:o(()=>[a("div",He,[a("div",We,l(e(_)),1),u(" Profiles ")])]),default:o(()=>[t($e)]),_:1})]),_:1},8,["value","style"])])]),_:1},8,["show"])):U("",!0)}}});const Je=W(Xe,[["__scopeId","data-v-0ae8108b"]]),Qe={class:"flex items-center justify-between"},Ze={class:"flex items-center gap-16px mt-24px"},et={class:"font-black text-2xl"},tt={class:"actions flex items-center gap-16px"},at={class:"items-center flex gap-8px"},ot={class:"flex items-center gap-8px"},St=O({__name:"RunDetails",setup(N){const{route:s,router:c}=re(),_=K(()=>s.params.id),{setTitle:$}=me(),{t:i}=V(),{state:f,taskRun:b,loading:S,getTaskRun:h,reRunTaskRun:v,stopTaskRun:I,deleteRun:P}=M(),m=[{label:i("Common.Button.Delete"),key:"delete",icon:pe(ce)}],y=async R=>{switch(R){case"delete":f.showDeleteModal=!0;break}},p=async()=>{await I(_.value)},d=()=>c.push({name:"main.run"}),r=E(null);return q(async()=>{if($("Details"),await h(_.value),!b.value)return d();r.value=setInterval(()=>{h(_.value)},2e3)}),Y(()=>{clearInterval(r.value)}),(R,g)=>{var F,D;const T=Z;return k(),G("div",null,[a("div",{class:"flex items-center gap-8px cursor-pointer",onClick:d},[t(C,{type:"goBack"}),t(T,null,{default:o(()=>[u(l(e(i)("Page.AutomationRuns.Label.BackToRuns")),1)]),_:1})]),a("div",Qe,[a("div",Ze,[a("div",et,[t(T,null,{default:o(()=>{var n;return[u(l((n=e(b))==null?void 0:n.app.name),1)]}),_:1})])]),a("div",tt,[[e(w).RUNNING,e(w).PENDING].includes((F=e(b))==null?void 0:F.status)?((D=e(b))==null?void 0:D.status)===e(w).RUNNING?(k(),L(e(B),{key:1,type:"error",style:{color:"white !important"},onClick:g[1]||(g[1]=n=>e(f).showStopModal=!0)},{default:o(()=>[a("div",ot,[t(C,{type:"square"}),u(" "+l(e(i)("Page.AutomationRuns.Button.StopRunning")),1)])]),_:1})):U("",!0):(k(),L(e(B),{key:0,loading:e(S),type:"primary",style:{color:"white !important"},onClick:g[0]||(g[0]=n=>e(v)(e(_)))},{default:o(()=>[a("div",at,[t(C,{type:"play"}),u(" "+l(e(i)("Page.AutomationRuns.Button.Run")),1)])]),_:1},8,["loading"])),t(_e,{trigger:"click",size:"huge","drop-down-actions":m,onSelect:y})])]),t(Je),t(X,{type:"delete",icon:"trash",header:"Delete task","is-show":e(f).showDeleteModal,"cancel-label":e(i)("Common.Button.Keep"),"submit-label":e(i)("Common.Button.Delete"),"action-submit":e(P),onClose:g[2]||(g[2]=n=>e(f).showDeleteModal=!1)},{body:o(()=>[t(T,null,{default:o(()=>[u(l(e(i)("Page.AutomationRuns.Label.ConfirmDelete"))+" "+l(e(b).app.name)+"?",1)]),_:1})]),_:1},8,["is-show","cancel-label","submit-label","action-submit"]),t(X,{"is-show":e(f).showStopModal,"onUpdate:isShow":g[3]||(g[3]=n=>e(f).showStopModal=n),type:"delete",icon:"trash",header:e(i)("Page.AutomationRuns.Label.StopRunningTask"),"cancel-label":e(i)("Common.Button.Keep"),"submit-label":e(i)("Common.Button.Stop"),"action-submit":p,loading:e(S),onClose:g[4]||(g[4]=n=>e(f).showStopModal=!1)},{body:o(()=>[t(T,null,{default:o(()=>[u(l(e(i)("Page.AutomationRuns.Label.StopRunningTaskDesc"))+" "+l(e(b).app.name)+"?",1)]),_:1})]),_:1},8,["is-show","header","cancel-label","submit-label","loading"])])}}});export{St as default};
