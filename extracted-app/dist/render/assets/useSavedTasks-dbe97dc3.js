import{I as O,H as j,a2 as L,ar as M,G as C,aq as U,ah as q,dm as F,aV as K,aU as I,bJ as W,bE as H,b1 as J,e1 as V,a3 as E,e2 as B,e3 as Q,e4 as X,dN as Y,a_ as Z,e5 as ee,e6 as ae}from"./main-8b08e1d6.js";import{l as te}from"./lodash-6114c6d4.js";import{a as se}from"./useScriptEditor-4173e447.js";import{b as s,r as z,c as N,h as k}from"./_plugin-vue_export-helper-b059e461.js";import{_ as R}from"./a-72358bba.js";const{user:_}=O(j()),ve=()=>{const{t}=L(),{goAppDetails:p,goTaskDetails:i,renderTaskRunStatus:b}=M(),{duration:g,formatDateTime:P}=U(),{router:y}=C(),m=z({showDeleteModal:!1,showDeleteMultiModal:!1});s(null);const o=s(!1),u=s([]),v=s([]),r=s(null),h=s([]),d=s({userId:_.value.id,name:"",page:1,limit:25,order:"desc",orderBy:"createdAt"}),f=s({page:1,limit:25,current_offset:0,next_offset:0,total_items:0}),D=e=>{y.push({name:"main.savedTaskDetails",params:{id:e}})},$=e=>({style:"cursor: pointer;",onclick:l=>{[...l.target.classList].some(G=>G.startsWith("n-data-table-td"))&&D(e.id)}}),S=s({createdAt:"descend"}),a=N(()=>[{type:"selection"},{type:"expand",renderExpand:e=>k("div",{class:"ml-30px flex flex-col gap-24px"},e.profiles.list.length?e.profiles.list.map((l,T)=>k("div",{class:"flex items-center justify-between"},[k("div",{},{default:()=>`${T+1}. ${l.name}`}),k(q,{type:"trash",class:"cursor-pointer",size:"20",color:"rgba(140, 140, 140, 1)",onClick:async()=>{await F(e.id,[l.id]),e.profiles.list.splice(T,1),window.$message.success(t("Page.AutomationTasks.Msg.ProfileRemoved"))}},{default:()=>null})])):k("span",t("Page.AutomationTasks.Label.NoProfile")))},{title:t("Page.AutomationTasks.Label.Name"),key:"name"},{title:t("Page.AutomationTasks.Label.App"),key:"app",render(e){return k(R,{class:"font-semibold",onClick:()=>p(e.app.id)},{default:()=>e.app.name||""})}},{title:t("Page.AutomationTasks.Label.Profiles"),key:"profiles",render(e){return k(R,{class:"font-semibold",onClick:()=>i(e.id,{tab:"profiles"})},{default:()=>e.profiles.list.length})}},{title:t("Page.AutomationTasks.Label.Runs"),key:"runs",render(e){return k(R,{class:"font-semibold",onClick:()=>i(e.id,{tab:"runs"})},{default:()=>e.runs.length})}},{title:t("Page.AutomationTasks.Label.LastRunStartedAt"),key:"createdAt",sorter:!0,sortOrder:S.value.createdAt,render(e){return e.runs.length?P(e.runs[0].createdAt):"-"}},{title:t("Page.AutomationTasks.Label.LastRunStatus"),key:"lastRunStatus",render(e){return e.runs.length?b(e.runs[0]):"-"}},{title:t("Page.AutomationTasks.Label.LastRunDuration"),key:"lastRunStatus",render(e){return e.runs.length?g.value(e.runs[0].createdAt,e.runs[0].finishedAt):"-"}},{key:"actions",render(e){return k("div",{class:"flex items-center justify-around"},[k(K,{trigger:"hover",size:"huge",dropDownActions:[{label:t("Common.Button.Edit"),key:"edit",icon:I(W)},{label:t("Common.Button.Delete"),key:"delete",icon:I(H)}],onSelect:async l=>{switch(l){case"delete":r.value=e,m.showDeleteModal=!0;break;case"shortcut":r.value=e;break;case"edit":D(e.id);break}}})])}}]),n=async e=>{try{o.value=!0;const{data:{data:l}}=await V({...d.value,appId:e});return v.value=te.uniqBy(E([...u.value,...l.items]),"id"),u.value=l.items,f.value=l.pagination,l.items}catch{u.value=[]}finally{o.value=!1}},A=J(()=>n(),500);return{state:m,loading:o,savedTasks:u,cachedSavedTasks:v,selectedTask:r,selectedTasks:h,defaultParams:d,pagination:f,columns:a,rowProps:$,editSavedTask:D,getAppSavedTasks:n,debounceGetSavedTasks:A,handleDeleteTask:async()=>{try{o.value=!0,await B(r.value.id),m.showDeleteModal=!1,window.$message.success(t("Page.AutomationTasks.Msg.TaskDeleted")),await n()}catch{}finally{o.value=!1}},handleDeleteMultiTasks:async()=>{try{o.value=!0,await Q(h.value),m.showDeleteMultiModal=!1,h.value=[],window.$message.success(t("Page.AutomationTasks.Msg.TasksDeleted")),await n()}catch{}finally{o.value=!1}},onPageUpdate:async e=>{d.value.page=e,await n()},onPageSizeUpdate:async e=>{d.value.page=1,d.value.limit=e,await n()},onSortChange:async e=>{const{order:l,columnKey:T}=e;d.value.order==="desc"&&l!=="descend"?(d.value.order="asc",S.value[T]="ascend"):(d.value.order="desc",S.value[T]="descend"),d.value.orderBy=T,d.value.page=1,await n()}}},ne=s("input"),c=s(null),pe=()=>{const{t}=L(),{variables:p}=se(),{goTaskRunDetails:i}=M(),{router:b}=C(),g=s(!1);return{activeTab:ne,savedTask:c,loading:g,variables:p,handleDeleteTask:async()=>{try{g.value=!0,await B(c.value.id),b.push({name:"main.savedTasks"}),window.$message.success(t("Page.AutomationTasks.Msg.TaskDeleted"))}catch{}finally{g.value=!1}},getSavedTaskDetails:async u=>{try{const{data:v}=await X(u);c.value=v.data,c.value.config.logging===void 0&&(c.value.config.logging=!0),p.value=c.value.variables}catch{c.value=null}},createTaskRun:async()=>{try{g.value=!0;const{data:u}=await Y({userId:_.value.id,taskId:c.value.id,appId:c.value.appId,status:Z.PENDING});i(u.data.id),window.$message.success(t("Page.AutomationTasks.Msg.TaskRunCreated"))}catch{}finally{g.value=!1}},updateTask:async()=>{try{c.value.variables=E(p.value),await ee(c.value.id,c.value),window.$message.success(t("Page.AutomationTasks.Msg.TaskUpdated"))}catch{}}}},w=s(null),me=()=>{const{duration:t,formatDateTime:p}=U(),{t:i}=L(),{goTaskRunDetails:b,renderTaskRunStatus:g}=M(),P=z({showExportDataModal:!1}),y=s([]),m=s(null),o=s({createdAt:"descend",finishedAt:!1}),u=N(()=>[{title:i("Page.AutomationTasks.Label.App"),key:"app",render(a){return a.app.name||"-"}},{title:i("Page.AutomationTasks.Label.Task"),key:"task",render(a){return a.task.name||"-"}},{title:i("Page.AutomationTasks.Label.Results"),key:"results",render(a){return k(R,{class:"font-semibold",onClick:()=>{m.value=a,P.showExportDataModal=!0}},{default:()=>a.profileStorages.length})}},{title:i("Page.AutomationTasks.Label.StartedAt"),key:"createdAt",sorter:!0,sortOrder:o.value.createdAt,render(a){return a.createdAt?p(a.createdAt):"-"}},{title:i("Page.AutomationTasks.Label.FinishedAt"),key:"finishedAt",sorter:!0,sortOrder:o.value.finishedAt,render(a){return a.finishedAt?p(a.finishedAt):"-"}},{title:i("Page.AutomationTasks.Label.Duration"),key:"duration",render(a){return t.value(a.createdAt,a.finishedAt)}},{title:i("Page.AutomationTasks.Label.Status"),key:"status",render(a){return g(a)}}]),v=s(!1),r=s({userId:_.value.id,page:1,limit:25,order:"desc",orderBy:"createdAt"}),h=s({page:1,limit:25,current_offset:0,next_offset:0,total_items:0}),d=a=>({style:"cursor: pointer;",onclick:n=>{[...n.target.classList].some(x=>x.startsWith("n-data-table-td"))&&b(a.id)}}),f=async a=>{try{w.value=a,v.value=!0;const{data:{data:n}}=await ae({...r.value,taskId:a});y.value=n.items,h.value=n.pagination}catch{y.value=[],window.$message.error("App not found!")}finally{v.value=!1}};return{state:P,selectedRun:m,runs:y,columns:u,loading:v,pagination:h,rowProps:d,getTaskRuns:f,onPageUpdate:async a=>{r.value.page=a,await f(w.value)},onPageSizeUpdate:async a=>{r.value.page=1,r.value.limit=a,await f(w.value)},onSortChange:async a=>{const{order:n,columnKey:A}=a;r.value.order==="desc"&&n!=="descend"?(r.value.order="asc",o.value[A]="ascend"):(r.value.order="desc",o.value[A]="descend"),r.value.orderBy=A,r.value.page=1,await f(w.value)}}};export{ve as a,me as b,pe as u};
