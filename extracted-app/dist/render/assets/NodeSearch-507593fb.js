import{b as ne}from"./useScriptEditor-4173e447.js";import{d as j,b as y,z as oe,c as C,h as f,N as ae,J as le,i as se,r as re,S as ie,X as ue,u as V}from"./_plugin-vue_export-helper-b059e461.js";import{c as de,N as ce}from"./Select-f7c79767.js";import{f as me,d as k,c2 as fe,b as pe,dA as he,h as ve,j as D,g8 as ge,B as be,m as Se,cq as ye,dB as A,dC as _e,dD as Ce,g9 as Te,dE as xe,cj as Ie,o as we,D as _}from"./main-8b08e1d6.js";import{_ as Be}from"./Input-96fa4693.js";import"./Suffix-fc59bb7a.js";import"./lodash-6114c6d4.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";function Fe(t){return t.map(P)}function P(t){var i,o;return typeof t=="string"?{label:t,value:t}:t.type==="group"?{type:"group",label:(i=t.label)!==null&&i!==void 0?i:t.name,value:(o=t.value)!==null&&o!==void 0?o:t.name,key:t.key||t.name,children:t.children.map(l=>P(l))}:t}const Re=me([k("auto-complete",`
 z-index: auto;
 position: relative;
 display: inline-flex;
 width: 100%;
 `),k("auto-complete-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[fe({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),Oe=Object.assign(Object.assign({},D.props),{to:A.propTo,menuProps:Object,bordered:{type:Boolean,default:void 0},clearable:{type:Boolean,default:void 0},defaultValue:{type:String,default:null},loading:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},placeholder:String,placement:{type:String,default:"bottom-start"},value:String,blurAfterSelect:Boolean,clearAfterSelect:Boolean,getShow:Function,inputProps:Object,renderOption:Function,renderLabel:Function,size:String,options:{type:Array,default:()=>[]},zIndex:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onSelect:[Function,Array],onBlur:[Function,Array],onFocus:[Function,Array],onInput:[Function,Array]}),Ve=j({name:"AutoComplete",props:Oe,setup(t){const{mergedBorderedRef:i,namespaceRef:o,mergedClsPrefixRef:s,inlineThemeDisabled:l}=pe(t),h=he(t),{mergedSizeRef:w,mergedDisabledRef:B,mergedStatusRef:F}=h,T=y(null),v=y(null),a=y(t.defaultValue),c=oe(t,"value"),d=ve(c,a),r=y(!1),m=y(!1),g=D("AutoComplete","-auto-complete",Re,ge,t,s),b=C(()=>Fe(t.options)),R=C(()=>{const{getShow:e}=t;return e?e(d.value||""):!!d.value}),E=C(()=>R.value&&r.value&&!!b.value.length),L=C(()=>be(b.value,de("value","children")));function x(e){const{"onUpdate:value":n,onUpdateValue:u,onInput:p}=t,{nTriggerFormInput:I,nTriggerFormChange:te}=h;u&&_(u,e),n&&_(n,e),p&&_(p,e),a.value=e,I(),te()}function U(e){const{onSelect:n}=t,{nTriggerFormInput:u,nTriggerFormChange:p}=h;n&&_(n,e),u(),p()}function q(e){const{onBlur:n}=t,{nTriggerFormBlur:u}=h;n&&_(n,e),u()}function $(e){const{onFocus:n}=t,{nTriggerFormFocus:u}=h;n&&_(n,e),u()}function X(){m.value=!0}function K(){window.setTimeout(()=>{m.value=!1},0)}function Y(e){var n,u,p;switch(e.key){case"Enter":if(!m.value){const I=(n=v.value)===null||n===void 0?void 0:n.getPendingTmNode();I&&(N(I.rawNode),e.preventDefault())}break;case"ArrowDown":(u=v.value)===null||u===void 0||u.next();break;case"ArrowUp":(p=v.value)===null||p===void 0||p.prev();break}}function N(e){(e==null?void 0:e.value)!==void 0&&(U(e.value),t.clearAfterSelect?x(null):e.label!==void 0&&x(e.label),r.value=!1,t.blurAfterSelect&&ee())}function H(){x(null)}function J(e){r.value=!0,$(e)}function G(e){r.value=!1,q(e)}function Q(e){r.value=!0,x(e)}function W(e){N(e.rawNode)}function Z(e){var n;!((n=T.value)===null||n===void 0)&&n.contains(we(e))||(r.value=!1)}function ee(){var e,n;!((e=T.value)===null||e===void 0)&&e.contains(document.activeElement)&&((n=document.activeElement)===null||n===void 0||n.blur())}const z=C(()=>{const{common:{cubicBezierEaseInOut:e},self:{menuBoxShadow:n}}=g.value;return{"--n-menu-box-shadow":n,"--n-bezier":e}}),S=l?Se("auto-complete",void 0,z,t):void 0,O=y(null),M={focus:()=>{var e;(e=O.value)===null||e===void 0||e.focus()},blur:()=>{var e;(e=O.value)===null||e===void 0||e.blur()}};return{focus:M.focus,blur:M.blur,inputInstRef:O,uncontrolledValue:a,mergedValue:d,isMounted:ye(),adjustedTo:A(t),menuInstRef:v,triggerElRef:T,treeMate:L,mergedSize:w,mergedDisabled:B,active:E,mergedStatus:F,handleClear:H,handleFocus:J,handleBlur:G,handleInput:Q,handleToggle:W,handleClickOutsideMenu:Z,handleCompositionStart:X,handleCompositionEnd:K,handleKeyDown:Y,mergedTheme:g,cssVars:l?void 0:z,themeClass:S==null?void 0:S.themeClass,onRender:S==null?void 0:S.onRender,mergedBordered:i,namespace:o,mergedClsPrefix:s}},render(){const{mergedClsPrefix:t}=this;return f("div",{class:`${t}-auto-complete`,ref:"triggerElRef",onKeydown:this.handleKeyDown,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd},f(_e,null,{default:()=>[f(Ce,null,{default:()=>{if(this.$slots.default)return Te(this.$slots,"default",{handleInput:this.handleInput,handleFocus:this.handleFocus,handleBlur:this.handleBlur,value:this.mergedValue});const{mergedTheme:o}=this;return f(Be,{ref:"inputInstRef",status:this.mergedStatus,theme:o.peers.Input,themeOverrides:o.peerOverrides.Input,bordered:this.mergedBordered,value:this.mergedValue,placeholder:this.placeholder,size:this.mergedSize,disabled:this.mergedDisabled,clearable:this.clearable,loading:this.loading,inputProps:this.inputProps,onClear:this.handleClear,onFocus:this.handleFocus,onUpdateValue:this.handleInput,onBlur:this.handleBlur},{suffix:()=>{var s,l;return(l=(s=this.$slots).suffix)===null||l===void 0?void 0:l.call(s)},prefix:()=>{var s,l;return(l=(s=this.$slots).prefix)===null||l===void 0?void 0:l.call(s)}})}}),f(xe,{show:this.active,to:this.adjustedTo,containerClass:this.namespace,zIndex:this.zIndex,teleportDisabled:this.adjustedTo===A.tdkey,placement:this.placement,width:"target"},{default:()=>f(ae,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{var i;if((i=this.onRender)===null||i===void 0||i.call(this),!this.active)return null;const{menuProps:o}=this;return le(f(ce,Object.assign({},o,{clsPrefix:t,ref:"menuInstRef",theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,"auto-pending":!0,class:[`${t}-auto-complete-menu`,this.themeClass,o==null?void 0:o.class],style:[o==null?void 0:o.style,this.cssVars],treeMate:this.treeMate,multiple:!1,renderLabel:this.renderLabel,renderOption:this.renderOption,size:"medium",onToggle:this.handleToggle})),[[Ie,this.handleClickOutsideMenu,void 0,{capture:!0}]])}})})]}))}}),Le=j({__name:"NodeSearch",setup(t){const{scriptId:i}=ne(),{editor:o}=se(i),s={rectX:0,rectY:0,position:{x:0,y:0,zoom:1}},l=re({query:"",active:!1,activeId:null,selected:!1,autocompleteItems:[]}),h=C(()=>l.autocompleteItems.filter(a=>l.query?a.label.toLocaleLowerCase().includes(l.query.toLocaleLowerCase()):a).map(a=>{const{id:c,label:d,description:r,category:m}=a;return{label:d,value:c,description:r,category:m}})),w=()=>{const a=document.querySelector(".vue-flow");a.classList.add("add-transition");const{width:c,height:d}=a.getBoundingClientRect();s.rectX=c/2,s.rectY=d/2,s.position=o.value.getTransform(),l.autocompleteItems=o.value.getNodes.value.map(({label:r,id:m,computedPosition:g,data:b})=>({label:r,id:m,position:g,description:b.options.description||""}))},B=a=>{const c=l.autocompleteItems.find(R=>R.id===a),{x:d,y:r}=c.position,{rectX:m,rectY:g}=s;o.value.setTransform({zoom:.8,x:-(d-m),y:-(r-g)});const b=o.value.getNode.value(a);o.value.addSelectedNodes([b])},F=()=>{setTimeout(()=>{document.querySelector(".vue-flow").classList.remove("add-transition")},100)},T=a=>{B(a),F()},v=a=>f("div",{className:"flex flex-col"},[a.label,f("small",{className:"text-gray-500 truncate"},a.description)]);return(a,c)=>{const d=Ve;return ie(),ue(d,{id:"node-search",value:V(l).query,"onUpdate:value":c[0]||(c[0]=r=>V(l).query=r),clearable:"","input-props":{autocomplete:"disabled"},options:V(h),"render-label":v,placeholder:"Search node...",onFocus:w,onSelect:T},null,8,["value","options"])}}});export{Le as default};
