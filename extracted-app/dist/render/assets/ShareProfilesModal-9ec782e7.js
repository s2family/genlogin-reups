import{a2 as w,bk as l,a3 as u,g4 as y,bl as I,aL as E}from"./main-8b08e1d6.js";import{M as S}from"./Modal-0f4a5102.js";import{l as R}from"./lodash-6114c6d4.js";import{d as L,r as x,w as _,S as D,X as k,Y as p,D as n,u as a,t as C}from"./_plugin-vue_export-helper-b059e461.js";import{_ as M}from"./Input-96fa4693.js";import{_ as B,a as T}from"./Checkbox-ce86da58.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";import"./Divider-65f3d898.js";import"./Suffix-fc59bb7a.js";const q=L({__name:"ShareProfilesModal",props:{modelShow:{type:Boolean,default:!1},email:{type:String,default:""},ids:{type:Array,default:()=>[]},rights:{type:Array,default:()=>[]}},emits:["update:show","success"],setup(m,{emit:f}){const t=m,{t:s}=w(),c=[l.VIEW,l.SYNC,l.EDIT,l.DELETE],e=x({targetInvite:t.email||"",selectedRights:t.rights.length?u(t.rights):u(c),submitting:!1}),h=()=>{f("update:show",!1),e.targetInvite=t.email||"",e.selectedRights=t.rights.length?u(t.rights):u(c),e.submitting=!1},P=async()=>{if(!e.targetInvite){window.$message.warning(s("Page.Profiles.Msg.BlankTarget"));return}try{e.submitting=!0;const o=C(t.ids);await Promise.all(o.map(async i=>{const d=R.difference(c,e.selectedRights);await y(i,!0);const r={user_email:e.targetInvite,add_permissions:e.selectedRights,remove_permissions:d};await I(i,r)})),window.$message.success(s("Page.Profiles.Msg.ProfileShared")),h(),f("success")}catch{}finally{e.submitting=!1}};return _(()=>t.email,o=>{e.targetInvite=o}),_(()=>t.rights,o=>{e.selectedRights=o}),(o,i)=>{const d=M,r=B,b=E,v=T;return D(),k(S,{"is-show":m.modelShow,header:a(s)("Page.Profiles.Label.ShareProfiles"),icon:"share","submit-label":a(s)("Page.Profiles.Actions.Invite"),"action-submit":P,loading:a(e).submitting,onClose:h},{body:p(()=>[n(d,{value:a(e).targetInvite,"onUpdate:value":i[0]||(i[0]=g=>a(e).targetInvite=g),disabled:!!m.email,placeholder:a(s)("Page.Profiles.Label.InviteSomeone"),autofocus:""},null,8,["value","disabled","placeholder"]),n(v,{value:a(e).selectedRights,"onUpdate:value":i[1]||(i[1]=g=>a(e).selectedRights=g),class:"mt-16px"},{default:p(()=>[n(b,{"item-style":"display: flex;"},{default:p(()=>[n(r,{value:a(l).VIEW,label:a(s)("Page.Profiles.Label.PermitRead")},null,8,["value","label"]),n(r,{value:a(l).SYNC,label:a(s)("Page.Profiles.Label.PermitSyncData")},null,8,["value","label"]),n(r,{value:a(l).EDIT,label:a(s)("Page.Profiles.Label.PermitEdit")},null,8,["value","label"]),n(r,{value:a(l).DELETE,label:a(s)("Page.Profiles.Label.PermitDelete")},null,8,["value","label"])]),_:1})]),_:1},8,["value"])]),_:1},8,["is-show","header","submit-label","loading"])}}});export{q as default};
