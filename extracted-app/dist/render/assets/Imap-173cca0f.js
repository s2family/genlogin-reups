import{ah as P,gh as J,bu as K,aL as Q,am as W,aA as Z,a7 as ee}from"./main-8b08e1d6.js";import{b as oe,a as te}from"./useScriptEditor-4173e447.js";import{_ as s}from"./ModalNode-47dd364b.js";import{d as ae,i as ne,r as le,b as ie,m as pe,S as m,X as f,Y as l,D as t,u as o,U as C,F as w,V as g,a2 as d,E as u,ad as se,$ as c}from"./_plugin-vue_export-helper-b059e461.js";import{_ as re}from"./Select-f7c79767.js";import{_ as me}from"./FormItem-52ed65a1.js";import{_ as ue,a as de}from"./Checkbox-ce86da58.js";import{_ as ce}from"./Input-96fa4693.js";import{_ as _e}from"./InputGroup-20db4544.js";import{_ as fe}from"./Scrollbar-e90e60b7.js";import{_ as be}from"./useConsole-dd6c2120.js";import{_ as ge,a as ve}from"./CollapseItem-114ac5a0.js";import"./lodash-6114c6d4.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";import"./ScriptEditor-c5673dff.js";import"./InputSearch.vue_vue_type_script_setup_true_lang-d786940a.js";import"./useMyApps-6a511b1e.js";import"./a-72358bba.js";import"./Divider-65f3d898.js";import"./Modal-0f4a5102.js";import"./DynamicInput-debc4a5e.js";import"./Remove-be3cc84a.js";import"./DataTable-e5054828.js";import"./RadioGroup-69a7fbba.js";import"./Radio-c980589e.js";import"./Suffix-fc59bb7a.js";import"./Pagination-ce77c3f3.js";import"./_baseUniq-35fed69a.js";import"./toInteger-0dcb6e10.js";import"./SelectProfiles.vue_vue_type_script_setup_true_lang-3d20c4d9.js";import"./FormMakingResult-fec35bca.js";import"./useSavedTasks-dbe97dc3.js";import"./useRunScript-b4e924db.js";import"./Upload-46a3755a.js";import"./Progress-0b0a0198.js";import"./_createCompounder-4af3bdce.js";import"./Alert-2eccd136.js";import"./InputNumber-c85d5887.js";import"./Grid-308f499b.js";import"./DatePicker-91499e1f.js";import"./ModalConfirm-92ee844f.js";import"./useSelectProfiles-b9438807.js";import"./firefox-icon-2ab5a045.js";import"./Form-e484375f.js";import"./FormItemGridItem-951b0746.js";import"./vuedraggable.umd-e6c5d70a.js";import"./InputSearch-1469c448.js";const Ve=g("span",null,"Content",-1),bo=ae({__name:"Imap",setup(ke){const{scriptId:S}=oe(),{editor:T,variables:j,modalNode:e}=ne(S),{newVariable:_,createNewVariable:h,onSearchVariable:y,variableOptions:x,prepareAutomation:O}=te(T.value,j.value),N=()=>{const p=h();e.options.outputVariable=p},I=()=>{const p=h();e.options.outputSubjectVariable=p},E=()=>{const p=h();e.options.outputContentVariable=p},F=[{label:"Gmail",value:"gmail"},{label:"Outlook/Hotmail",value:"outlook"},{label:"Yahoo",value:"yahoo"},{label:"Custom",value:"custom"}],A=[{label:"Global (g)",value:"g"},{label:"Case insensitive (i)",value:"i"},{label:"Multiline (m)",value:"m"}],r=le({sender:"",subject:"",emailContent:"",extracted:"",error:""}),v=ie(!1),R=async()=>{try{Object.assign(r,{sender:"",subject:"",emailContent:"",extracted:"",error:""}),v.value=!0;const p=await O();p.testId=e.node.id;const{data:a}=await J(p);if(!a.sender)throw new Error("No mail found");Object.assign(r,{sender:a.sender,subject:a.subject,emailContent:a.content,extracted:a.extracted,error:""})}catch(p){Object.assign(r,{sender:"",subject:"",emailContent:"",extracted:"",error:p.message||p.error.message})}finally{v.value=!1}};return pe(()=>{e.options.outputVariable=e.options.outputVariable||null,e.options.imapProvider=e.options.imapProvider||"gmail",e.options.imapHost=e.options.imapHost||"",e.options.imapPort=e.options.imapPort||"",e.options.imapEmail=e.options.imapEmail||"",e.options.imapPassword=e.options.imapPassword||"",e.options.imapRefreshToken=e.options.imapRefreshToken||"",e.options.imapClientId=e.options.imapClientId||"",e.options.imapBox=e.options.imapBox||"INBOX",e.options.imapTimeout=e.options.imapTimeout||"30",e.options.imapNewestMail=e.options.imapNewestMail===void 0?!0:e.options.imapNewestMail,e.options.imapUnseenOnly=e.options.imapUnseenOnly===void 0?!0:e.options.imapUnseenOnly,e.options.imapTimeAgo=e.options.imapTimeAgo||"",e.options.imapTLS=e.options.imapTLS===void 0?!0:e.options.imapTLS,e.options.imapMarkAsRead=e.options.imapMarkAsRead===void 0?!1:e.options.imapMarkAsRead,e.options.imapContentPattern=e.options.imapContentPattern||"",e.options.indexMatch=e.options.indexMatch||"",e.options.imapContentPatternFlags=e.options.imapContentPatternFlags||[],e.options.imapSubjectContains=e.options.imapSubjectContains||"",e.options.imapFromContains=e.options.imapFromContains||"",e.options.outputSubjectVariable=e.options.outputSubjectVariable||"",e.options.outputContentVariable=e.options.outputContentVariable||""}),(p,a)=>{const V=re,i=me,B=K,U=Q,k=ue,L=ce,b=W,$=de,Y=Z,D=_e,H=ee,M=fe,G=be,X=ge,q=ve;return m(),f(M,{trigger:"none",style:{height:"55vh"}},{default:l(()=>[t(U,{vertical:""},{default:l(()=>[t(i,{"show-feedback":!1,label:"Email service"},{default:l(()=>[t(V,{value:o(e).options.imapProvider,"onUpdate:value":a[0]||(a[0]=n=>o(e).options.imapProvider=n),placeholder:"",options:F},null,8,["value"])]),_:1}),o(e).options.imapProvider==="custom"?(m(),C(w,{key:0},[t(i,{"show-feedback":!1,label:"IMAP host"},{default:l(()=>[t(s,{modelValue:o(e).options.imapHost,"onUpdate:modelValue":a[1]||(a[1]=n=>o(e).options.imapHost=n),placeholder:"imap.gmail.com"},null,8,["modelValue"])]),_:1}),t(i,{"show-feedback":!1,label:"IMAP port"},{default:l(()=>[t(s,{modelValue:o(e).options.imapPort,"onUpdate:modelValue":a[2]||(a[2]=n=>o(e).options.imapPort=n),placeholder:"993"},null,8,["modelValue"])]),_:1}),t(U,null,{default:l(()=>[t(B,{value:o(e).options.imapTLS,"onUpdate:value":a[3]||(a[3]=n=>o(e).options.imapTLS=n)},null,8,["value"]),g("span",{class:"cursor-pointer select-none",onClick:a[4]||(a[4]=n=>o(e).options.imapTLS=!o(e).options.imapTLS)}," TLS secure ")]),_:1})],64)):d("",!0),t(i,{"show-feedback":!1,label:"Email"},{default:l(()=>[t(s,{modelValue:o(e).options.imapEmail,"onUpdate:modelValue":a[5]||(a[5]=n=>o(e).options.imapEmail=n),placeholder:"Your email"},null,8,["modelValue"])]),_:1}),t(i,{"show-feedback":!1,label:"Password"},{default:l(()=>[t(s,{modelValue:o(e).options.imapPassword,"onUpdate:modelValue":a[6]||(a[6]=n=>o(e).options.imapPassword=n),placeholder:"Your email password"},null,8,["modelValue"])]),_:1}),t(i,{"show-feedback":!1,label:"Refresh token (Optional)"},{default:l(()=>[t(s,{modelValue:o(e).options.imapRefreshToken,"onUpdate:modelValue":a[7]||(a[7]=n=>o(e).options.imapRefreshToken=n),placeholder:"Your email refresh token"},null,8,["modelValue"])]),_:1}),t(i,{"show-feedback":!1,label:"Client ID (Optional)"},{default:l(()=>[t(s,{modelValue:o(e).options.imapClientId,"onUpdate:modelValue":a[8]||(a[8]=n=>o(e).options.imapClientId=n),placeholder:"Your email client ID"},null,8,["modelValue"])]),_:1}),t(i,{"show-feedback":!1,label:"Mailbox"},{default:l(()=>[t(s,{modelValue:o(e).options.imapBox,"onUpdate:modelValue":a[9]||(a[9]=n=>o(e).options.imapBox=n),placeholder:"INBOX"},null,8,["modelValue"])]),_:1}),t(k,{checked:o(e).options.imapUnseenOnly,"onUpdate:checked":a[10]||(a[10]=n=>o(e).options.imapUnseenOnly=n)},{default:l(()=>[u(" Unseen mail only ")]),_:1},8,["checked"]),t(k,{checked:o(e).options.imapMarkAsRead,"onUpdate:checked":a[11]||(a[11]=n=>o(e).options.imapMarkAsRead=n)},{default:l(()=>[u(" Mark mail as read ")]),_:1},8,["checked"]),t(k,{checked:o(e).options.imapNewestMail,"onUpdate:checked":a[12]||(a[12]=n=>o(e).options.imapNewestMail=n)},{default:l(()=>[u(" Get latest mail ")]),_:1},8,["checked"]),o(e).options.imapNewestMail?d("",!0):(m(),C(w,{key:1},[t(i,{"show-feedback":!1,label:"Time received since now (Minutes)"},{default:l(()=>[t(s,{modelValue:o(e).options.imapTimeAgo,"onUpdate:modelValue":a[13]||(a[13]=n=>o(e).options.imapTimeAgo=n),placeholder:"Minutes"},null,8,["modelValue"])]),_:1}),t(i,{"show-feedback":!1,label:"Sender email contains"},{default:l(()=>[t(s,{modelValue:o(e).options.imapFromContains,"onUpdate:modelValue":a[14]||(a[14]=n=>o(e).options.imapFromContains=n),placeholder:"Email"},null,8,["modelValue"])]),_:1})],64)),t(i,{"show-feedback":!1,label:"Content mail contains"},{default:l(()=>[t(D,null,{default:l(()=>[t(L,{value:o(e).options.imapContentPattern,"onUpdate:value":a[15]||(a[15]=n=>o(e).options.imapContentPattern=n),placeholder:"Regex"},{prefix:l(()=>[u(" / ")]),_:1},8,["value"]),t(Y,{trigger:"hover",placement:"bottom"},{trigger:l(()=>[t(b,null,{default:l(()=>[u("Flags")]),_:1})]),default:l(()=>[t($,{value:o(e).options.imapContentPatternFlags,"onUpdate:value":a[16]||(a[16]=n=>o(e).options.imapContentPatternFlags=n)},{default:l(()=>[t(U,{vertical:""},{default:l(()=>[(m(),C(w,null,se(A,(n,z)=>t(k,{key:z,value:n.value,label:n.label},null,8,["value","label"])),64))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),o(e).options.imapContentPatternFlags&&o(e).options.imapContentPatternFlags.includes("g")?(m(),f(i,{key:2,"show-feedback":!1,label:"Matched index"},{default:l(()=>[t(s,{modelValue:o(e).options.indexMatch,"onUpdate:modelValue":a[17]||(a[17]=n=>o(e).options.indexMatch=n),placeholder:"Default first matched"},null,8,["modelValue"])]),_:1})):d("",!0),t(i,{"show-feedback":!1,label:"Read mail timeout (seconds)"},{default:l(()=>[t(s,{modelValue:o(e).options.imapTimeout,"onUpdate:modelValue":a[18]||(a[18]=n=>o(e).options.imapTimeout=n),placeholder:""},null,8,["modelValue"])]),_:1}),t(b,{loading:o(v),disabled:o(v),type:"primary",onClick:R},{default:l(()=>[u(" Test ")]),_:1},8,["loading","disabled"]),o(r).error?(m(),f(H,{key:3,type:"error"},{default:l(()=>[u(" Error: "+c(o(r).error),1)]),_:1})):d("",!0),o(r).sender?(m(),C(w,{key:4},[g("pre",null,"Extracted: "+c(o(r).extracted),1),t(q,{"default-expanded-names":"mail"},{default:l(()=>[t(X,{name:"mail",title:"Matched mail"},{default:l(()=>[t(M,{style:{"{max-height":"500px"}},{default:l(()=>[g("pre",null,"From: "+c(o(r).sender),1),g("pre",null,"Subject: "+c(o(r).subject),1)]),_:1}),Ve,t(G,{rows:10,log:o(r).emailContent},null,8,["log"])]),_:1})]),_:1})],64)):d("",!0),t(i,{"show-feedback":!1,label:"Output variable"},{default:l(()=>[t(V,{value:o(e).options.outputVariable,"onUpdate:value":a[19]||(a[19]=n=>o(e).options.outputVariable=n),options:o(x),clearable:"",filterable:"","on-search":o(y)},{empty:l(()=>[o(_).length?(m(),f(b,{key:0,dashed:"",onClick:N},{icon:l(()=>[t(P,{type:"add"})]),default:l(()=>[u(" Create "+c(o(_)),1)]),_:1})):d("",!0)]),_:1},8,["value","options","on-search"])]),_:1}),t(i,{"show-feedback":!1,label:"Output subject variable"},{default:l(()=>[t(V,{value:o(e).options.outputSubjectVariable,"onUpdate:value":a[20]||(a[20]=n=>o(e).options.outputSubjectVariable=n),options:o(x),clearable:"",filterable:"","on-search":o(y)},{empty:l(()=>[o(_).length?(m(),f(b,{key:0,dashed:"",onClick:I},{icon:l(()=>[t(P,{type:"add"})]),default:l(()=>[u(" Create "+c(o(_)),1)]),_:1})):d("",!0)]),_:1},8,["value","options","on-search"])]),_:1}),t(i,{"show-feedback":!1,label:"Output content variable"},{default:l(()=>[t(V,{value:o(e).options.outputContentVariable,"onUpdate:value":a[21]||(a[21]=n=>o(e).options.outputContentVariable=n),options:o(x),clearable:"",filterable:"","on-search":o(y)},{empty:l(()=>[o(_).length?(m(),f(b,{key:0,dashed:"",onClick:E},{icon:l(()=>[t(P,{type:"add"})]),default:l(()=>[u(" Create "+c(o(_)),1)]),_:1})):d("",!0)]),_:1},8,["value","options","on-search"])]),_:1})]),_:1})]),_:1})}}});export{bo as default};
