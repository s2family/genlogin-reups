import{I as B,H as N,a2 as L,ar as C,dK as M,aq as z,aV as E,aU as O,bE as F,dL as G,ey as I,ez as $,eA as U,a_ as K,am as _,e6 as j,eB as q}from"./main-8b08e1d6.js";import{r as x,b as u,c as R,h as d}from"./_plugin-vue_export-helper-b059e461.js";import{_ as S}from"./a-72358bba.js";const{user:H}=B(N()),f=x({showDeleteModal:!1,showDeleteMultiModal:!1,showExportDataModal:!1,stopTaskRunModal:!1,stopMultiTaskRunsModal:!1}),se=()=>{const{t:n}=L(),{goAppDetails:g,goTaskDetails:T,goTaskRunDetails:r,renderTaskRunStatus:p}=C(),{duration:A,formatDateTime:h}=z(),k=u([]),y=u([]),o=u(null),t=u(!1),l=u({userId:H.value.id,page:1,limit:25,order:"desc",orderBy:"createdAt"}),w=u({page:1,limit:25,current_offset:0,next_offset:0,total_items:0}),P=e=>({style:"cursor: pointer;",onclick:v=>{[...v.target.classList].some(D=>D.startsWith("n-data-table-td"))&&r(e.id)}}),a=u({createdAt:"descend",finishedAt:!1}),i=async e=>{try{t.value=!0,await I(e),r(e)}catch{}finally{t.value=!1}},b=R(()=>[{type:"selection",width:"5%"},{title:n("Page.AutomationRuns.Label.App"),key:"app",render(e){return d(S,{class:"font-semibold",onClick:()=>g(e.app.id)},{default:()=>e.app.name||""})}},{title:n("Page.AutomationRuns.Label.Task"),key:"task",render(e){return d(S,{class:"font-semibold",onClick:()=>T(e.task.id)},{default:()=>e.task.name||""})}},{title:n("Page.AutomationRuns.Label.Results"),key:"results",render(e){return d(S,{class:"font-semibold",onClick:()=>{o.value=e,f.showExportDataModal=!0}},{default:()=>e.profileStorages.length})}},{title:n("Page.AutomationRuns.Label.StartedAt"),key:"createdAt",sorter:!0,sortOrder:a.value.createdAt,render(e){return h(e.createdAt)}},{title:n("Page.AutomationRuns.Label.FinishedAt"),key:"finishedAt",sorter:!0,sortOrder:a.value.finishedAt,render(e){return e.finishedAt?h(e.finishedAt):"-"}},{title:n("Page.AutomationRuns.Label.Duration"),key:"duration",render(e){return A.value(e.createdAt,e.finishedAt)}},{title:n("Page.AutomationRuns.Label.Status"),key:"status",render(e){return p(e)}},{key:"action",width:"10%",render(e){const{status:v}=e;return d("div",{class:"flex items-center justify-around"},[(()=>v===K.RUNNING?d(_,{type:"error",onClick:()=>{f.stopTaskRunModal=!0,o.value=e},ghost:!0},{default:()=>"Stop"}):d(_,{type:"primary",onClick:()=>i(e.id)},{default:()=>"Run"}))(),d(E,{trigger:"hover",size:"huge",dropDownActions:[{label:n("Common.Button.Delete"),key:"delete",icon:O(F)}],onSelect:async D=>{switch(D){case"delete":o.value=e,f.showDeleteModal=!0;break}}})])}}]),c=async()=>{try{t.value=!0;const{data:{data:e}}=await j({...l.value});k.value=e.items,w.value=e.pagination}catch{k.value=[]}finally{t.value=!1}};return{state:f,taskRuns:k,selectedTaskRuns:y,selectedTaskRun:o,columns:b,loading:t,defaultParams:l,pagination:w,rowProps:P,getTaskRuns:c,handleDeleteRun:async()=>{try{t.value=!0,await U(o.value.id),f.showDeleteModal=!1,await c(),window.$message.success(n("Page.AutomationRuns.Msg.TaskRunDeleted"))}catch{}finally{t.value=!1}},handleDeleteMultiRuns:async()=>{try{t.value=!0,await q(y.value),f.showDeleteMultiModal=!1,y.value=[],await c(),window.$message.success(n("Page.AutomationRuns.Msg.TaskRunDeleted"))}catch{}finally{t.value=!1}},onPageUpdate:async e=>{l.value.page=e,await c()},onPageSizeUpdate:async e=>{l.value.page=1,l.value.limit=e,await c()},onSortChange:async e=>{const{order:v,columnKey:m}=e;l.value.order==="desc"&&v!=="descend"?(l.value.order="asc",a.value[m]="ascend"):(l.value.order="desc",a.value[m]="descend"),l.value.orderBy=m,l.value.page=1,await c()},stopTaskRun:async()=>{try{t.value=!0,await $(o.value.id),f.stopTaskRunModal=!1,await c()}catch{o.value=null}finally{t.value=!1}}}},s=u(null),V=u({cpuSum:0,memSum:0,cpuAverage:0,memAverage:0,cpuMax:-1/0,memMax:-1/0}),ne=()=>{const{t:n}=L(),g=x({showDeleteModal:!1,showStopModal:!1}),{goTaskRuns:T}=C(),r=u(!1),p=u(!1),A=R(()=>s.value?s.value.task.profiles.list.length:0),h=R(()=>s.value?s.value.profileStatuses.filter(a=>a.status===M.RUNNING).length:0),k=R(()=>s.value?s.value.profileStatuses.filter(a=>a.status===M.SUCCESS).length:0),y=R(()=>s.value?s.value.profileStatuses.filter(a=>a.status===M.FAIL).length:0),o=R(()=>s.value?s.value.profileStorages:0),t=async a=>{try{if(p.value)return;p.value=!0;const{data:i}=await G(a);s.value=i.data}catch{s.value=null}finally{p.value=!1}};return{progressData:V,state:g,taskRun:s,loading:r,fetchingTaskRun:p,totalProfiles:A,processingProfiles:h,finishedProfiles:k,failedProfiles:y,totalOutputData:o,getTaskRun:t,reRunTaskRun:async(a,i=[])=>{try{r.value=!0,await I(a,i),await t(a)}catch{s.value=null}finally{r.value=!1}},stopTaskRun:async a=>{try{r.value=!0,await $(a),g.showStopModal=!1,await t(a)}catch{s.value=null}finally{r.value=!1}},deleteRun:async a=>{try{r.value=!0,await U(a),g.showDeleteModal=!1,T(),window.$message.success(n("Page.AutomationRuns.Msg.TaskRunDeleted"))}catch{}finally{r.value=!1}}}};export{se as a,ne as u};
