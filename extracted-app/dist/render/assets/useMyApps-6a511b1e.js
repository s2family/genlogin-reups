import{I as ae,H as se,a2 as T,aq as j,G as oe,ar as O,aV as ne,aU as b,fp as re,bE as le,b1 as pe,fq as q,dG as G,fr as J,aX as ie,fs as ce,ft as de,a3 as ue,cd as Ae,fu as ge,fv as me,dJ as ve,am as fe,x as ye,aW as U,cc as we,cz as he,fw as ke,dj as Pe,fx as be,e6 as xe,e1 as $e,fy as _e}from"./main-8b08e1d6.js";import{a as Le}from"./useScriptEditor-4173e447.js";import{d as X,S as Q,U as Y,V,r as M,b as o,c as R,h as _}from"./_plugin-vue_export-helper-b059e461.js";import{_ as F}from"./a-72358bba.js";const De={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Me=V("path",{d:"M368 192h-16v-80a96 96 0 1 0-192 0v80h-16a64.07 64.07 0 0 0-64 64v176a64.07 64.07 0 0 0 64 64h224a64.07 64.07 0 0 0 64-64V256a64.07 64.07 0 0 0-64-64zm-48 0H192v-80a64 64 0 1 1 128 0z",fill:"currentColor"},null,-1),Se=[Me],Re=X({name:"LockClosed",render:function(A,d){return Q(),Y("svg",De,Se)}}),Te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ie=V("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),Be=V("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1),Ue=[Ie,Be],Ce=X({name:"Refresh",render:function(A,d){return Q(),Y("svg",Te,Ue)}}),L=M({deleteApp:!1,exportAppByKey:!1,deleteMultiApps:!1}),W=M({id:"",key:"",expiredAt:null}),{user:D}=ae(se()),Ge=()=>{const{t:a}=T(),{formatDateTime:A,fromNow:d}=j(),{router:x}=oe(),g=M({showRenameModal:!1,showSelectLegacyScriptModal:!1,newName:""}),{goAppDetails:k}=O(),h=o(!1),m=o([]),n=o([]),c=o(null),v=R(()=>m.value.map(e=>{const{id:l,name:p}=e;return{label:p,value:l}})),s=o("all"),r=o({total:0,supcription:0}),i=o({userId:D.value.id,name:"",page:1,limit:25,order:"desc",orderBy:"updatedAt",type:null}),P=o({page:1,limit:25,current_offset:0,next_offset:0,total_items:0}),u=o({createdAt:!1,updatedAt:"descend"}),K=async e=>{const l=window.$message.loading(a("Page.AutomationApps.Label.Updating"),{duration:0});try{await me(e)}catch{}finally{l.destroy()}},I=async(e,l)=>{const{data:p}=await q(e);p.data&&(G(p.data,l),window.$message.success(a("Page.AutomationApps.Msg.AppExported")))},N=async()=>{const{data:{data:e}}=await _e({userId:D.value.id});r.value.total=e.total,r.value.supcription=e.subscription},t=async()=>{try{h.value=!0;const{data:{data:e}}=await ve(i.value);m.value=e.items,P.value=e.pagination,await N()}catch{m.value=[]}finally{h.value=!1}},y=async e=>{const{data:l}=await J(e);l&&window.$message.success(a("Page.AutomationApps.Msg.AppExported"))},$=R(()=>[{type:"selection"},{title:a("Page.AutomationApps.Label.Name"),key:"name",render(e){return e.name||""}},{title:a("Page.AutomationApps.Label.ModifiedAt"),key:"updatedAt",sorter:!0,sortOrder:u.value.updatedAt,render(e){return d(e.updatedAt)}},{title:a("Page.AutomationApps.Label.CreatedAt"),key:"createdAt",sorter:!0,sortOrder:u.value.createdAt,render(e){return A(e.createdAt)}},{title:a("Page.AutomationApps.Label.ExpiredAt"),key:"expiredAt",sorter:!0,sortOrder:u.value.expiredAt,render(e){return e.expiredAt?A(e.expiredAt):"-"}},{title:a("Common.Label.Version"),key:"version",render(e){return e.version||e.script.version||""}},{title:"",key:"actions",render(e){const l=()=>{var w;return _(fe,{type:"primary",class:"mr-8px",style:{visibility:(w=e==null?void 0:e.metadata)!=null&&w.protected?"hidden":"visible"},onClick:()=>{x.push({name:"main.scriptEditor",params:{id:e.id}})}},{default:()=>a("Page.AutomationApps.Button.Open")})},p=()=>{var w;if((w=e==null?void 0:e.metadata)!=null&&w.protected)return _(ye,{trigger:"hover"},{default:()=>a("Page.AutomationApps.Label.ScriptProtected"),trigger:b(Re,{class:"ml-4",size:"24",color:"orange"})})},S=()=>{var H;let w=[{label:a("Page.AutomationApps.Button.Export"),key:"export",icon:b(U,{color:"green"})},{label:a("Page.AutomationApps.Button.ExportProtected"),key:"exportProtected",icon:b(U,{color:"orange"})},{label:a("Page.AutomationApps.Button.ExportKeyProtected"),key:"exportKeyProtected",icon:b(U,{color:"orange"})}];return(H=e==null?void 0:e.metadata)!=null&&H.protected&&(w=[{label:a("Page.AutomationApps.Button.UpdateVersion"),key:"update",icon:b(Ce)}]),w};return _("div",[l(),_(ne,{trigger:"hover",size:"huge",dropDownActions:[...S(),{label:a("Page.AutomationApps.Button.Rename"),key:"rename",icon:b(re)},{label:a("Page.AutomationApps.Button.Delete"),key:"delete",icon:b(le,{color:"red"})}],onSelect:async w=>{switch(c.value=e,w){case"export":await I(e.id,`${e.name}.genlogin`);break;case"exportKeyProtected":W.id=e.id,L.exportAppByKey=!0;break;case"exportProtected":await y(e.id);break;case"rename":g.newName=e.name,g.showRenameModal=!0;break;case"update":await K(e.id),window.$message.success(a("Page.AutomationApps.Msg.AppUpdated")),t();break;case"delete":L.deleteApp=!0;break}}}),p()])}}]),B=e=>({style:"cursor: pointer;",onclick:l=>{[...l.target.classList].some(S=>S.startsWith("n-data-table-td"))&&k(e.id)}}),Z=async e=>{const l=we(),{data:p}=await he({id:l,name:e.name||"New App",description:e.description||"",version:"1.0",script:{...e,id:l,version:"1.0"},input:[],table:[],enableInput:!0,userId:D.value.id});p.data?window.$message.success("App imported!"):window.$message.warning("Import failed. Please check your app file!")},ee=async(e,l)=>{const p=window.$message.loading("Importing...",{duration:0});try{await ke(e,l),window.$message.success("App imported!")}catch{}finally{p.destroy()}},te=pe(t,500);return{exportAppState:W,state:g,showModal:L,selectedApps:n,selectedApp:c,loading:h,apps:m,appOptions:v,columns:$,activeTab:s,stats:r,defaultParams:i,pagination:P,rowProps:B,fetchApps:t,debounceFetchApps:te,handleScroll:async e=>{const{next_offset:l}=P.value,p=e.currentTarget;p.scrollTop+p.offsetHeight>=p.scrollHeight-20&&l!==null&&await t()},deleteApp:async()=>{try{await Pe(c.value.id),window.$message.success(a("Page.AutomationApps.Msg.AppDeleted")),L.deleteApp=!1,c.value=null,await t()}catch{}},deleteMultiApps:async()=>{try{await be(n.value),window.$message.success(a("Page.AutomationApps.Msg.AppDeleted")),L.deleteMultiApps=!1,n.value=[],await t()}catch{}},exportApp:I,exportProtectedApp:y,createApp:Z,importApp:ee,onPageUpdate:async e=>{i.value.page=e,await t()},onPageSizeUpdate:async e=>{i.value.page=1,i.value.limit=e,await t()},onSortChange:async e=>{const{order:l,columnKey:p}=e;i.value.order==="desc"&&l!=="descend"?(i.value.order="asc",u.value[p]="ascend"):(i.value.order="desc",u.value[p]="descend"),i.value.orderBy=p,i.value.page=1,await t()}}},f=o(null),Ee=M({showCreateTaskModal:!1,showDeleteModal:!1}),C=o(null),Je=()=>{const{t:a}=T(),{variables:A}=Le(),d=o(!0);return{appDetails:f,state:Ee,variables:A,isPermit:d,getAppDetails:async n=>{var c,v,s,r;try{d.value=!0;const{data:i}=await ie(n);if(f.value=i.data,f.value.enableInput===null&&(f.value.enableInput=!0),A.value=f.value.script.variables,(v=(c=f.value)==null?void 0:c.metadata)!=null&&v.productId){const P=await ce(f.value.metadata.productId);C.value=P.data;try{const{data:u}=await de((r=(s=f.value)==null?void 0:s.metadata)==null?void 0:r.hash);d.value=u}catch{}}else C.value=null}catch{f.value=null,window.$message.error("App not found!")}},buyApp:async n=>{try{return await ge(n)}catch{return null}},productData:C,updateApp:async()=>{try{f.value.script.variables=ue(A.value),await Ae(f.value),window.$message.success("App updated!")}catch{f.value=null,window.$message.error("App update failed!")}},exportApp:async(n,c)=>{const{data:v}=await q(n);v.data&&(G(v.data,c),window.$message.success(a("Page.AutomationApps.Msg.AppExported")))},exportProtectedApp:async n=>{const{data:c}=await J(n);c.data&&window.$message.success(a("Page.AutomationApps.Msg.AppExported"))}}},E=o([]),Xe=()=>{const{t:a}=T(),{duration:A,formatDateTime:d}=j(),{goTaskDetails:x,goTaskRunDetails:g,renderTaskRunStatus:k}=O(),h=M({showExportDataModal:!1}),m=o(null),n=o({createdAt:"descend",finishedAt:!1}),c=R(()=>[{title:a("Page.AutomationRuns.Label.App"),key:"app",render(t){return t.app.name||"-"}},{title:a("Page.AutomationRuns.Label.Task"),key:"task",render(t){return _(F,{class:"font-semibold",onClick:()=>x(t.task.id)},{default:()=>t.task.name||""})}},{title:a("Page.AutomationRuns.Label.Results"),key:"results",render(t){return _(F,{class:"font-semibold",onClick:()=>{m.value=t,h.showExportDataModal=!0}},{default:()=>t.profileStorages.length})}},{title:a("Page.AutomationRuns.Label.StartedAt"),key:"createdAt",sorter:!0,sortOrder:n.value.createdAt,render(t){return t.createdAt?d(t.createdAt):"-"}},{title:a("Page.AutomationRuns.Label.FinishedAt"),key:"finishedAt",sorter:!0,sortOrder:n.value.finishedAt,render(t){return t.finishedAt?d(t.finishedAt):"-"}},{title:a("Page.AutomationRuns.Label.Duration"),key:"duration",render(t){return A.value(t.createdAt,t.finishedAt)}},{title:a("Page.AutomationRuns.Label.Status"),key:"status",render(t){return k(t)}}]),v=o(!1),s=o(null),r=o({userId:D.value.id,page:1,limit:25,order:"desc",orderBy:"createdAt"}),i=o({page:1,limit:25,current_offset:0,next_offset:0,total_items:0}),P=t=>({style:"cursor: pointer;",onclick:y=>{[...y.target.classList].some(B=>B.startsWith("n-data-table-td"))&&g(t.id)}}),u=async t=>{try{s.value=t,v.value=!0;const{data:{data:y}}=await xe({...r.value,appId:t});E.value=y.items,i.value=y.pagination}catch{E.value=[],window.$message.error("App not found!")}finally{v.value=!1}};return{state:h,selectedRun:m,runs:E,columns:c,loading:v,defaultParams:r,pagination:i,rowProps:P,getAppRuns:u,onPageUpdate:async t=>{r.value.page=t,await u(s.value)},onPageSizeUpdate:async t=>{r.value.page=1,r.value.limit=t,await u(s.value)},onSortChange:async t=>{const{order:y,columnKey:$}=t;r.value.order==="desc"&&y!=="descend"?(r.value.order="asc",n.value[$]="ascend"):(r.value.order="desc",n.value[$]="descend"),r.value.orderBy=$,r.value.page=1,await u(s.value)}}},z=o([]),Qe=()=>{const{t:a}=T(),{goTaskDetails:A}=O(),d=o(null),x=R(()=>[{title:a("Page.AutomationTasks.Label.App"),key:"app",render(s){return s.app.name||"-"}},{title:a("Page.AutomationRuns.Label.Task"),key:"task",render(s){return s.name||"-"}},{title:a("Page.AutomationTasks.Label.Profiles"),key:"profiles",render(s){return s.profiles.list.length}}]),g=o({userId:D.value.id,page:1,limit:25,order:"desc",orderBy:"createdAt"}),k=o({page:1,limit:25,current_offset:0,next_offset:0,total_items:0}),h=s=>({style:"cursor: pointer;",onclick:()=>{A(s.id)}}),m=o(!1),n=async s=>{try{d.value=s,m.value=!0;const{data:{data:r}}=await $e({...g.value,appId:s});z.value=r.items,k.value=r.pagination}catch{z.value=[],window.$message.error("App not found!")}finally{m.value=!1}};return{tasks:z,columns:x,loading:m,defaultParams:g,pagination:k,rowProps:h,getAppSavedTasks:n,onPageUpdate:async s=>{g.value.page=s,await n(d.value)},onPageSizeUpdate:async s=>{g.value.page=1,g.value.limit=s,await n(d.value)}}};export{Ge as a,Xe as b,Qe as c,Je as u};
