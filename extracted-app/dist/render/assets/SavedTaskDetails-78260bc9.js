import{G as te,a2 as J,ar as ue,a7 as W,aL as ae,aq as pe,ah as U,be as Ae,dk as le,dl as Se,a0 as ce,am as G,aA as Ce,a1 as me,dm as ie,I as $e,ad as Ue,aY as Le,aV as Re,a8 as De,aj as ze,bE as Be,ai as Ie}from"./main-8b08e1d6.js";import{_ as _e}from"./DataTable.vue_vue_type_style_index_0_lang-cdaf49f4.js";import{b as fe,u as ge}from"./useSavedTasks-dbe97dc3.js";import{d as X,c as I,m as ve,f as se,S as $,X as M,u as e,b as T,U as oe,D as t,Y as s,V as l,E as _,$ as d,q as V,h as D,w as Ne,ag as re,e as ye,o as Ge,a2 as ee,F as ke,a8 as Me,a1 as je}from"./_plugin-vue_export-helper-b059e461.js";import Ke from"./ModalConfirm-92ee844f.js";import{D as Ve}from"./vuedraggable.umd-e6c5d70a.js";import{M as Oe}from"./Modal-0f4a5102.js";import{u as qe}from"./useSelectProfiles-b9438807.js";import{u as Ee,a as de}from"./uniqBy-ee48ba02.js";import{_ as he}from"./DataTable-e5054828.js";import{_ as we}from"./Pagination-ce77c3f3.js";import{_ as be}from"./Input-96fa4693.js";import{_ as Fe}from"./Scrollbar-e90e60b7.js";import{T as Ye,a as Qe}from"./TaskInput-b53c909e.js";import{_ as Xe}from"./Divider-65f3d898.js";import"./lodash-6114c6d4.js";import"./axios-1e30d922.js";import"./xlsx-f5126985.js";import"./useScriptEditor-4173e447.js";import"./a-72358bba.js";import"./firefox-icon-2ab5a045.js";import"./_baseUniq-35fed69a.js";import"./Checkbox-ce86da58.js";import"./RadioGroup-69a7fbba.js";import"./Radio-c980589e.js";import"./Suffix-fc59bb7a.js";import"./Select-f7c79767.js";import"./InputNumber-c85d5887.js";import"./Remove-be3cc84a.js";import"./FormItem-52ed65a1.js";import"./Grid-308f499b.js";import"./Form-e484375f.js";import"./Variables-e3cd83d6.js";import"./FormMakingResult-fec35bca.js";import"./useMyApps-6a511b1e.js";import"./useRunScript-b4e924db.js";import"./useConsole-dd6c2120.js";import"./Upload-46a3755a.js";import"./Progress-0b0a0198.js";import"./_createCompounder-4af3bdce.js";import"./Alert-2eccd136.js";import"./DynamicInput-debc4a5e.js";const He=X({__name:"Runs",setup(O){const{route:w}=te(),f=I(()=>w.params.id),{runs:y,columns:z,loading:u,pagination:r,rowProps:b,getTaskRuns:k,onPageUpdate:m,onPageSizeUpdate:L,onSortChange:A}=fe();return ve(async()=>{await k(f.value)}),se(async()=>{await k(f.value)}),(g,R)=>($(),M(e(_e),{class:"mt-2",loading:e(u),data:e(y),columns:e(z),pagination:e(r),"row-key":p=>p.id,"row-props":e(b),"on-page-update":e(m),"on-page-size-update":e(L),onUpdateSorter:e(A)},null,8,["loading","data","columns","pagination","row-key","row-props","on-page-update","on-page-size-update","onUpdateSorter"]))}}),Je={class:"table-header flex items-center justify-between"},We={class:"flex items-center justify-between"},Ze={class:"flex items-center gap-24px justify-end mt-16px"},et=X({__name:"AddGroup",emits:["selectedGroup"],setup(O,{emit:w}){const{t:f}=J(),{loading:y,selectedGroup:z,groups:u,defaultParams:r,pagination:b,getGroups:k,onPageUpdate:m,onPageSizeUpdate:L}=Ee(),{perPageOptions:A}=ue(),g=T([]);ve(async()=>{const{offset:v,limit:h}=r.value;await k({offset:v,limit:h})});const R=v=>({style:"cursor: pointer;",onClick:async h=>{z.value=v}}),p=[{type:"selection",width:"5%"},{title:"#",key:"key",render:(v,h)=>`${h+1}`},{title:f("Page.Profiles.Label.GroupName"),key:"name"}],j=v=>{g.value=v,w("selectedGroup",g.value)};return(v,h)=>{const S=W,P=he,q=we,E=ae;return $(),oe("div",Je,[t(E,{vertical:""},{default:s(()=>[l("div",We,[l("div",null,[t(S,{depth:"3"},{default:s(()=>[_(d(e(f)("Page.AutomationTasks.Label.SelectedGroups"))+" "+d(e(g).length),1)]),_:1})])]),t(P,{"checked-row-keys":e(g),"onUpdate:checkedRowKeys":h[0]||(h[0]=n=>V(g)?g.value=n:null),loading:e(y),columns:p,data:e(u),"row-props":R,"row-key":n=>n.id,"virtual-scroll":"","max-height":"500px",onUpdateCheckedRowKeys:j},null,8,["checked-row-keys","loading","data","row-key"]),l("div",Ze,[l("div",null,d(e(f)("Page.AutomationTasks.Label.Group"))+" "+d(e(b).total_items),1),t(q,{page:e(b).page,"page-size":e(b).limit,"item-count":e(b).total_items,"show-size-picker":"","page-slot":5,"page-sizes":e(A),"on-update:page":e(m),"on-update:page-size":e(L)},null,8,["page","page-size","item-count","page-sizes","on-update:page","on-update:page-size"])])]),_:1})])}}}),tt={class:"table-header flex items-center justify-between"},at={class:"flex items-center justify-between"},st={class:"flex items-center gap-24px justify-end mt-16px"},ot={class:"flex gap-2 justify-end mt-8px"},nt=X({__name:"AddProfileModal",props:{taskId:{type:String,default:null},modelShow:{type:Boolean,default:!1}},emits:["update:modelShow","added"],setup(O,{emit:w}){const f=O,{t:y}=J(),{perPageOptions:z}=ue(),u=T(),r=T(!1),b=T([]),{fromNow:k}=pe(),m=T("allProfile"),{loading:L,defaultParams:A,pagination:g,profiles:R,selectedProfiles:p,getProfiles:j,debounceSearch:v,onPageUpdate:h,onPageSizeUpdate:S,onSortChange:P}=qe(),q=T({id:"descend",name:"descend"}),E=I(()=>[{type:"selection",width:"5%"},{title:"#",width:"5%",key:"key",render:(o,i)=>`${i+1}`},{width:"20%",title:"Name",key:"name",render(o){const{name:i}=o.profile_data;return D("div",[D("div",{class:"flex items-center"},[D(U,{type:"chrome",class:"mr-8px"}),D("span",i)])])},sorter:!0,sortOrder:q.value.name},{width:"13%",title:"Updated",key:"updated_at",render(o){return o.updated_at?k(o.updated_at):"-"}}]),n=T(!1),a=T([]),B=()=>{w("update:modelShow",!1),p.value=[],R.value=[],A.value.search="",g.value.page=1},K=async()=>{if(m.value==="group")try{n.value=!0,L.value=!0;let o=[],i=0;for(;i!==null;){const N=await Ae({limit:100,offset:i},b.value),{data:F}=N.data;o=[...o,...F.items],i=F.pagination.next_offset}const x=o.map(N=>({id:N.id,name:N.profile_data.name}));await le(f.taskId,x),window.$message.success("Profiles added!"),w("added")}catch{}finally{n.value=!1}else if(m.value==="allProfile")try{n.value=!0;const o=a.value.filter(i=>p.value.includes(i.id));await le(f.taskId,o),window.$message.success("Profiles added!"),w("added")}catch{window.$message.error("An error has occurred!")}finally{n.value=!1}},Y=o=>{if(!o.length)return;const i=R.value.filter(x=>o.includes(x.id)).map(x=>({id:x.id,created_at:x.created_at,name:x.profile_data.name}));a.value=de([...a.value,...i],"id")};function Q(o){m.value=o}Ne(()=>f.modelShow,async o=>{o?await j():a.value=[]});const c=async o=>{r.value=!1;const x=u.value.split(`
`).map(N=>+N);if(x.length){const F=(await Se(x)).data.data;a.value=de([...a.value,...F],"id"),x.forEach(H=>{p.value.includes(H)||p.value.push(H)})}u.value=""};return(o,i)=>{const x=be,N=W,F=he,H=we,Pe=ae,ne=ce,Z=G,xe=Ce,Te=me;return $(),M(Oe,{"is-show":O.modelShow,header:e(y)("Page.AutomationTasks.Label.QuickAddProfile"),icon:"quick","submit-label":e(y)("Common.Button.Add"),"action-submit":K,loading:e(n),width:"640px",onClose:B},{body:s(()=>[t(Te,{type:"line","default-value":"allProfile",animated:"","onUpdate:value":Q},{suffix:s(()=>[t(xe,{show:e(r),"onUpdate:show":i[7]||(i[7]=C=>V(r)?r.value=C:null),class:"w-350px",placement:"bottom",trigger:"click"},{trigger:s(()=>[t(Z,{type:"primary",ghost:""},{default:s(()=>[_(" Add by IDs ")]),_:1})]),default:s(()=>[t(x,{value:e(u),"onUpdate:value":i[4]||(i[4]=C=>V(u)?u.value=C:null),placeholder:"Enter IDs",type:"textarea",clearable:"",class:"w-full",onKeyup:i[5]||(i[5]=re(()=>c,["enter"]))},null,8,["value"]),l("div",ot,[t(Z,{type:"default",ghost:"",onClick:i[6]||(i[6]=C=>u.value="")},{default:s(()=>[_(" Clear ")]),_:1}),t(Z,{type:"primary",onClick:c},{default:s(()=>[_(" Add ")]),_:1})])]),_:1},8,["show"])]),default:s(()=>[t(ne,{"display-directive":"show",name:"allProfile",tab:e(y)("Page.AutomationTasks.Label.AllProfiles")},{default:s(()=>[l("div",tt,[t(Pe,{vertical:""},{default:s(()=>[l("div",at,[t(x,{value:e(A).search,"onUpdate:value":i[0]||(i[0]=C=>e(A).search=C),type:"text",placeholder:e(y)("Common.Label.Search"),clearable:"",class:"!w-auto","on-input":e(v),onKeyup:i[1]||(i[1]=re(()=>e(j),["enter"]))},{prefix:s(()=>[t(U,{type:"search"})]),_:1},8,["value","placeholder","on-input"]),l("div",null,[t(N,{depth:"3"},{default:s(()=>[_(d(e(y)("Page.AutomationTasks.Label.SelectedProfiles"))+" "+d(e(p).length),1)]),_:1})])]),t(F,{"checked-row-keys":e(p),"onUpdate:checkedRowKeys":i[2]||(i[2]=C=>V(p)?p.value=C:null),loading:e(L),columns:e(E),data:e(R),"row-key":C=>C.id,"virtual-scroll":"","max-height":"500px",onUpdateCheckedRowKeys:Y,onUpdateSorter:e(P)},null,8,["checked-row-keys","loading","columns","data","row-key","onUpdateSorter"]),l("div",st,[l("div",null,d(e(y)("Page.AutomationTasks.Label.Profiles"))+" "+d(e(g).total_items),1),t(H,{page:e(g).page,"page-size":e(g).limit,"item-count":e(g).total_items,"show-size-picker":"","page-slot":5,"page-sizes":e(z),"on-update:page":e(h),"on-update:page-size":e(S)},null,8,["page","page-size","item-count","page-sizes","on-update:page","on-update:page-size"])])]),_:1})])]),_:1},8,["tab"]),t(ne,{"display-directive":"show",name:"group",tab:e(y)("Page.AutomationTasks.Label.Group")},{default:s(()=>[t(et,{onSelectedGroup:i[3]||(i[3]=C=>b.value=C)})]),_:1},8,["tab"])]),_:1})]),_:1},8,["is-show","header","submit-label","loading"])}}}),lt={class:"table-header flex gap-5 mt-24px"},it={class:"flex items-center gap-8px"},rt={class:"flex text-lg items-center justify-between cursor-move my-2 h-10 px-5 border-1"},dt={class:"flex items-center gap-16px min-h-1.5"},ut={class:"font-semibold"},pt=X({__name:"Profiles",props:{taskId:{type:String,default:null}},setup(O){const{route:w}=te(),f=I(()=>w.params.id),y=I(()=>w.query.tab),z=I(()=>w.query.newTask),{formatDateTime:u}=pe(),{t:r}=J(),{activeTab:b,savedTask:k,getSavedTaskDetails:m}=ge(),L=T([]),A=I(()=>L.value.reduce((n,{columnKey:a,order:B})=>(n[a]=B,n),{})),g=async n=>{await ie(f.value,[n]),await m(f.value),window.$message.success(r("Page.AutomationTasks.Msg.ProfileRemoved"))},R=I(()=>[{type:"selection",width:"3%"},{title:"#",width:"5%",key:"key",render:(n,a)=>`${a+1}`},{width:"20%",title:r("Page.Profiles.Label.Name"),key:"name",render(n){const{browser:a,name:B}=n;return D("div",[D("div",{class:"flex items-center"},[D(U,{type:a,class:"mr-8px"}),D("span",B)])])},sortOrder:A.value.name||!1,sorter(n,a){return n.name-a.name}},{title:r("Page.Profiles.Label.Tags")},{width:"10%",title:r("Page.Profiles.Label.Proxy"),key:"proxy"},{width:"15%",title:r("Page.Profiles.Label.UpdatedAt"),key:"updatedAt",sortOrder:A.value.updatedAt||!1,sorter:{compare:(n,a)=>n.updatedAt-a.updatedAt},render(n){return u(n.updatedAt)}},{width:"10%",render(n){return D(G,{type:"error",ghost:!0,onClick:()=>g(n.id)},{default:()=>r("Page.AutomationTasks.Button.RemoveProfile")})}}]),p=T(""),j=I(()=>p.value?k.value.profiles.list.filter(n=>n.name.toLowerCase().includes(p.value.toLowerCase())):k.value.profiles.list),v=T(!1),h=T(!1),S=T([]),P=T(!1),q=async()=>{z.value&&(b.value="config"),await m(f.value)},E=async()=>{await ie(f.value,S.value),await m(f.value),S.value=[],h.value=!1,window.$message.success(r("Page.AutomationTasks.Msg.ProfileRemoved"))};return se(async()=>{b.value=y.value||"input",z.value&&(v.value=!0)}),ye(()=>{P.value=!1}),Ge(()=>{P.value=!1,p.value=""}),(n,a)=>{const B=be,K=ae,Y=Fe,Q=W;return $(),oe(ke,null,[l("div",lt,[t(e(G),{ghost:"",type:"primary",onClick:a[0]||(a[0]=c=>v.value=!0)},{default:s(()=>[l("div",it,[t(U,{type:"add"}),_(" "+d(e(r)("Page.AutomationTasks.Button.AddProfile")),1)])]),_:1}),t(B,{value:e(p),"onUpdate:value":a[1]||(a[1]=c=>V(p)?p.value=c:null),class:"!w-auto",placeholder:e(r)("Common.Label.Search"),clearable:""},null,8,["value","placeholder"]),e(P)?($(),M(e(G),{key:0,class:"ml-auto",type:"success",onClick:a[2]||(a[2]=c=>P.value=!e(P))},{icon:s(()=>[t(U,{type:"check"})]),default:s(()=>[_(" "+d(e(r)("Common.Button.Arrange")),1)]),_:1})):($(),M(e(G),{key:1,class:"ml-auto",ghost:"",onClick:a[3]||(a[3]=c=>P.value=!e(P))},{icon:s(()=>[t(U,{type:"shuffle"})]),default:s(()=>[_(" "+d(e(r)("Common.Button.Arrange")),1)]),_:1}))]),e(S).length>0?($(),M(K,{key:0,class:"my-2"},{default:s(()=>[t(e(G),{ghost:"",type:"error",onClick:a[4]||(a[4]=c=>h.value=!0)},{icon:s(()=>[t(U,{type:"trash"})]),default:s(()=>[_(" "+d(e(r)("Page.AutomationTasks.Button.RemoveProfile")),1)]),_:1})]),_:1})):ee("",!0),e(P)?($(),M(Y,{key:2,style:{height:"calc(100vh - 480px)"},class:"mt-24px"},{default:s(()=>[t(e(Ve),{modelValue:e(k).profiles.list,"onUpdate:modelValue":a[6]||(a[6]=c=>e(k).profiles.list=c),"item-key":"id"},{item:s(({index:c,element:o})=>[l("div",rt,[l("div",dt,[_(d(c+1)+". ",1),l("div",ut,d(o.name),1)])])]),_:1},8,["modelValue"])]),_:1})):($(),M(e(_e),{key:1,"checked-row-keys":e(S),"onUpdate:checkedRowKeys":a[5]||(a[5]=c=>V(S)?S.value=c:null),class:"mt-2",data:e(j),columns:e(R),"row-key":c=>c.id},null,8,["checked-row-keys","data","columns","row-key"])),t(nt,{"model-show":e(v),"onUpdate:modelShow":a[7]||(a[7]=c=>V(v)?v.value=c:null),"task-id":O.taskId,onAdded:q},null,8,["model-show","task-id"]),t(Ke,{type:"delete",icon:"trash",header:e(r)("Page.AutomationTasks.Label.DeleteProfiles"),"is-show":e(h),"cancel-label":e(r)("Common.Button.Keep"),"submit-label":e(r)("Common.Button.Delete"),"action-submit":E,onClose:a[8]||(a[8]=c=>h.value=!1)},{body:s(()=>[t(Q,null,{default:s(()=>[_(d(e(r)("Common.Label.ConfirmCheck")),1)]),_:1})]),_:1},8,["header","is-show","cancel-label","submit-label"])],64)}}}),ct={class:"flex items-center justify-between"},mt={class:"flex items-center gap-16px mt-24px"},_t={class:"font-black text-2xl"},ft={class:"flex items-center gap-16px"},gt={class:"items-center flex gap-8px"},vt={class:"flex items-center gap-4px"},yt={class:"flex items-center gap-4px"},kt={class:"log-number"},ht={class:"flex items-center gap-4px"},wt={class:"log-number"},bt={class:"actions w-full"},Pt={class:"flex items-center gap-16px p-16px"},xt={style:{color:"#fff"}},Tt=X({__name:"SavedTaskDetails",setup(O){const{route:w,router:f}=te(),y=I(()=>w.params.id),z=I(()=>w.query.tab),{t:u}=J(),{runs:r,getTaskRuns:b}=fe(),{activeTab:k,savedTask:m,loading:L,getSavedTaskDetails:A,createTaskRun:g,updateTask:R,handleDeleteTask:p}=ge(),{isDarkMode:j}=$e(Ue()),{setTitle:v}=Ie(),S=[{label:"Delete",key:"delete",icon:((n,a=null)=>()=>D(ze,a,{default:()=>D(n)}))(Be)}],P=async n=>{switch(n){case"delete":await p();break}},q=()=>f.push({name:"main.savedTasks"});se(async()=>{k.value=z.value||"input",v("Details"),await Promise.all([A(y.value),b(y.value)])}),ye(()=>{m.value=null});const E=async()=>{await R(),await g()};return(n,a)=>{const B=W,K=ce,Y=me,Q=Xe,c=De;return $(),oe(ke,null,[l("div",null,[l("div",{class:"flex items-center gap-8px cursor-pointer",onClick:q},[t(U,{type:"goBack"}),t(B,null,{default:s(()=>[_(d(e(u)("Page.AutomationTasks.Label.BackToSavedTasks")),1)]),_:1})]),l("div",ct,[l("div",mt,[l("div",_t,[t(B,null,{default:s(()=>{var o;return[_(d((o=e(m))==null?void 0:o.name),1)]}),_:1})]),t(e(Le),{round:"",bordered:!1},{default:s(()=>[_(d(e(u)("Page.AutomationTasks.Label.Task")),1)]),_:1})]),l("div",ft,[t(e(G),{type:"primary",style:{color:"white !important"},loading:e(L),disabled:e(L),onClick:e(g)},{default:s(()=>[l("div",gt,[t(U,{type:"play"}),_(" "+d(e(u)("Page.AutomationTasks.Button.RunTask")),1)])]),_:1},8,["loading","disabled","onClick"]),t(Re,{trigger:"click",size:"huge","drop-down-actions":S,onSelect:P})])]),t(Y,{value:e(k),"onUpdate:value":a[1]||(a[1]=o=>V(k)?k.value=o:null),class:"mt-16px",style:Me({"--number-bg-color":e(j)?"#262626":"#F0F0F0"})},{default:s(()=>[t(K,{name:"input"},{tab:s(()=>[l("div",vt,[t(U,{type:"play"}),_(" "+d(e(u)("Page.AutomationTasks.Label.Input")),1)])]),default:s(()=>[t(Ye)]),_:1}),t(K,{name:"profiles"},{tab:s(()=>{var o;return[l("div",yt,[l("div",kt,d((o=e(m))==null?void 0:o.profiles.list.length),1),_(" "+d(e(u)("Page.AutomationTasks.Label.Profiles")),1)])]}),default:s(()=>{var o;return[e(m)?($(),M(pt,{key:0,"task-id":(o=e(m))==null?void 0:o.id},null,8,["task-id"])):ee("",!0)]}),_:1}),t(K,{name:"config",tab:e(u)("Page.AutomationTasks.Label.Config")},{default:s(()=>[e(m)?($(),M(Qe,{key:0,config:e(m).config,"onUpdate:config":a[0]||(a[0]=o=>e(m).config=o)},null,8,["config"])):ee("",!0)]),_:1},8,["tab"]),t(K,{name:"runs",tab:"Runs"},{tab:s(()=>[l("div",ht,[l("div",wt,d(e(r).length),1),_(" "+d(e(u)("Page.AutomationTasks.Label.Runs")),1)])]),default:s(()=>[t(He)]),_:1})]),_:1},8,["value","style"])]),l("div",bt,[t(c,null,{default:s(()=>[t(Q),l("div",Pt,[t(e(G),{type:"primary",onClick:E},{default:s(()=>[t(U,{color:"#fff",class:"mr-8px",type:"play"}),l("div",xt,d(e(u)("Page.AutomationTasks.Button.SaveAndRun")),1)]),_:1}),t(e(G),{type:"primary",ghost:"",onClick:e(R)},{default:s(()=>[t(U,{class:"mr-8px",type:"save"}),_(" "+d(e(u)("Page.AutomationTasks.Button.Save")),1)]),_:1},8,["onClick"])])]),_:1})])],64)}}});const _a=je(Tt,[["__scopeId","data-v-3b6f510f"]]);export{_a as default};
